<!DOCTYPE html>
<!-- saved from url=(0070)http://www.tokiwinter.com/clustering-with-drbd-corosync-and-pacemaker/ -->
<html lang="en-US" prefix="og: http://ogp.me/ns#"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>Clustering with DRBD, Corosync and Pacemaker | Toki Winter</title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="http://www.tokiwinter.com/xmlrpc.php">
<!--[if lt IE 9]>
<script src="http://www.tokiwinter.com/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->

<!-- This site is optimized with the Yoast WordPress SEO plugin v1.4.7 - http://yoast.com/wordpress/seo/ -->
<meta name="robots" content="noodp,noydir">
<link rel="canonical" href="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/Clustering with DRBD, Corosync and Pacemaker _ Toki Winter.html">
<link rel="author" href="https://plus.google.com/109788843837820773373/about">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Clustering with DRBD, Corosync and Pacemaker - Toki Winter">
<meta property="og:url" content="http://www.tokiwinter.com/clustering-with-drbd-corosync-and-pacemaker/">
<meta property="og:site_name" content="Toki Winter">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@tokiwinter">
<meta name="twitter:creator" content="@tokiwinter">
<meta name="twitter:description" content="Introduction This article will cover the build of a two-node high-availability cluster using DRBD (RAID1 over TCP/IP), the Corosync cluster engine, and the Pacemaker resource manager on CentOS 6.4. There are many applications for this type of cluster – as a free alternative to RHCS for example. However, this example does have a couple of [...]">
<!-- / Yoast WordPress SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="Toki Winter » Feed" href="http://www.tokiwinter.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Toki Winter » Comments Feed" href="http://www.tokiwinter.com/comments/feed/">
<link rel="stylesheet" id="crayon-css" href="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/crayon.min.css" type="text/css" media="all">
<link rel="stylesheet" id="crayon-theme-test-theme-css" href="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/test-theme.css" type="text/css" media="all">
<link rel="stylesheet" id="crayon-font-monaco-css" href="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/monaco.css" type="text/css" media="all">
<link rel="stylesheet" id="cntctfrmStylesheet-css" href="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/style.css" type="text/css" media="all">
<link rel="stylesheet" id="twentytwelve-fonts-css" href="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/css" type="text/css" media="all">
<link rel="stylesheet" id="twentytwelve-style-css" href="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/style(1).css" type="text/css" media="all">
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://www.tokiwinter.com/wp-content/themes/twentytwelve/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<link rel="stylesheet" id="easy_table_style-css" href="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/style(2).css" type="text/css" media="all">
<link rel="stylesheet" id="acx-si-style-css" href="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/style(3).css" type="text/css" media="all">
<script async="" type="text/javascript" src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/ca-pub-2058880138595928.js"></script><script type="text/javascript" async="" src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/ga.js"></script><script type="text/javascript" async="" src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/ga.js"></script><script type="text/javascript" src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/jquery.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.2.1","is_admin":"0","ajaxurl":"http:\/\/www.tokiwinter.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type="text/javascript" src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/crayon.min.js"></script>
<script type="text/javascript" src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/wp-google-analytics.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.tokiwinter.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.tokiwinter.com/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 3.5.2">
<link rel="shortlink" href="http://www.tokiwinter.com/?p=1746">



<!-- Starting Styles For Social Media Icon From Acurax International www.acurax.com -->
<style type="text/css">
#divBottomRight img 
{
width: 32px; 
}
#divBottomRight 
{
min-width:0px; 
position: static; 
}
</style>
<!-- Ending Styles For Social Media Icon From Acurax International www.acurax.com -->



	<style type="text/css">
			.site-title,
		.site-description {
			position: absolute !important;
			clip: rect(1px 1px 1px 1px); /* IE7 */
			clip: rect(1px, 1px, 1px, 1px);
		}
		</style>
	<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #ffffff; }
</style>
</head>

<body class="single single-post postid-1746 single-format-standard custom-background custom-background-white custom-font-enabled single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<h1 class="site-title"><a href="http://www.tokiwinter.com/" title="Toki Winter" rel="home">Toki Winter</a></h1>
			<h2 class="site-description">Advanced UNIX for the experienced system administrator</h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<h3 class="menu-toggle">Menu</h3>
			<a class="assistive-text" href="http://www.tokiwinter.com/clustering-with-drbd-corosync-and-pacemaker/#content" title="Skip to content">Skip to content</a>
					<a href="http://www.tokiwinter.com/"><img src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/TokiWinter2-copy.jpg" class="header-image" width="581" height="157" alt=""></a>
		<br><br><br>
			<div class="nav-menu"><ul><li><a href="http://www.tokiwinter.com/" title="Home">Home</a></li><li class="page_item page-item-1124"><a href="http://www.tokiwinter.com/archives/">Archives</a></li><li class="page_item page-item-14"><a href="http://www.tokiwinter.com/who-is-toki-winter/">Who is Toki Winter?</a></li><li class="page_item page-item-134"><a href="http://www.tokiwinter.com/faq/">FAQ</a></li><li class="page_item page-item-624"><a href="http://www.tokiwinter.com/recommendations/">Recommendations</a></li><li class="page_item page-item-632"><a href="http://www.tokiwinter.com/consulting/">Consulting Services</a></li><li class="page_item page-item-563"><a href="http://www.tokiwinter.com/contact/">Contact Toki</a></li></ul></div>
		</nav><!-- #site-navigation -->
	</header><!-- #masthead -->

	<div id="main" class="wrapper">

	<div id="primary" class="site-content">
		<div id="content" role="main">

			
				
	<article id="post-1746" class="post-1746 post type-post status-publish format-standard hentry category-unix-linux-howtos-tutorials tag-centos tag-clustering tag-corosync tag-drbd tag-high-availability tag-nginx tag-pacemaker">
				<header class="entry-header">
									<h1 class="entry-title">Clustering with DRBD, Corosync and Pacemaker</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<h1>Introduction</h1>
<p>This article will cover the build of a two-node high-availability cluster using DRBD (RAID1 over TCP/IP), the Corosync cluster engine, and the Pacemaker resource manager on CentOS 6.4. There are <em>many</em> applications for this type of cluster – as a free alternative to RHCS for example. However, this example does have a couple of caveats. As this is being built in a lab environment on KVM guests, there will be no STONITH (Shoot The Other Node In The Head) (a type of fencing). If this cluster goes split-brain, there may be manual recovery required to intervene, tell DRBD who is primary and who is secondary, and so on. In a Production environment, we’d use STONITH to connect to ILOMs (for example) and power off or reboot a misbehaving node. Quorum will also need to be disabled, as this stack doesn’t yet support the use of quorum disks – if you want that go with RHCS (and use <code><strong>cman</strong></code> with the<code><strong> two_node</strong></code> parameter, with or without <code><strong>qdiskd</strong></code>).</p>
<p>This article, as always, presumes that you know what you are doing. The nodes used in this article are as follows:</p>
<ul>
<li>192.168.122.30 – <strong>rhcs-node01.local</strong> – first cluster node – running CentOS 6.4</li>
<li>192.168.122.31 – <strong>rhcs-node02.local</strong> – second cluster node – running CentOS 6.4</li>
<li>192.168.122.33 – failover IP address</li>
</ul>
<p>DRBD will be used to replicate a volume between the two nodes (in a Master/Slave fashion), and the hosts will eventually run the nginx webserver in a failover topology, with this example having documents being served from the replicated volume.</p>
<p>Ideally, four network interfaces per host should be used (1 for “standard” node communications, 1 for DRBD replication, 2 for Corosync), but for a lab environment a single interface per node is fine.</p>
<p>Let’s start the build …</p>
<p><span id="more-1746"></span></p>
<h1>Initial Node Preparation</h1>
<p>For the sake of simplicity, disable <strong><code>iptables</code></strong> and SELinux on each node:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443dfc4e" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># service iptables stop
# chkconfig iptables off
# sed -i 's/^\(SELINUX=\)enforcing/\1permissive/' /etc/selinux/config
# setenforce permissive</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443dfc4e-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfc4e-2">2</div><div class="crayon-num" data-line="crayon-5593a443dfc4e-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfc4e-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443dfc4e-1"><span class="crayon-p"># service iptables stop</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfc4e-2"><span class="crayon-p"># chkconfig iptables off</span></div><div class="crayon-line" id="crayon-5593a443dfc4e-3"><span class="crayon-p"># sed -i 's/^\(SELINUX=\)enforcing/\1permissive/' /etc/selinux/config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfc4e-4"><span class="crayon-p"># setenforce permissive</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Ensure that NTP is correctly configured (I do this in my <code><strong>kickstart</strong></code> configuration anyway):</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443dfcac" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># vi /etc/ntp.conf
# ntpdate 1.au.pool.ntp.org
# service ntpd start
# chkconfig ntpd on</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443dfcac-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfcac-2">2</div><div class="crayon-num" data-line="crayon-5593a443dfcac-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfcac-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443dfcac-1"><span class="crayon-p"># vi /etc/ntp.conf</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfcac-2"><span class="crayon-p"># ntpdate 1.au.pool.ntp.org</span></div><div class="crayon-line" id="crayon-5593a443dfcac-3"><span class="crayon-p"># service ntpd start</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfcac-4"><span class="crayon-p"># chkconfig ntpd on</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>If you are not using DNS, add entries to each of your host’s<code><strong> /etc/hosts</strong></code> files for all nodes in the cluster – or do so anyway as a safeguard against DNS failure:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443dfd11" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># vi /etc/hosts
192.168.122.30 rhcs-node01
192.168.122.31 rhcs-node02</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443dfd11-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfd11-2">2</div><div class="crayon-num" data-line="crayon-5593a443dfd11-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443dfd11-1"><span class="crayon-p"># vi /etc/hosts</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfd11-2"><span class="crayon-cn">192.168.122.30</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-i">node01</span></div><div class="crayon-line" id="crayon-5593a443dfd11-3"><span class="crayon-cn">192.168.122.31</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-i">node02</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>At this point, I configured LVM. I presented a disk to each node (themselves running as KVM guests, as discussed earlier), at <code><strong>/dev/vdb</strong></code> – verified with<code><strong> fdisk -l</strong></code>:<code></code></p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443dfd67" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># fdisk -l
...
Disk /dev/vdb: 2147 MB, 2147483648 bytes
16 heads, 63 sectors/track, 4161 cylinders
Units = cylinders of 1008 * 512 = 516096 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00000000</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443dfd67-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfd67-2">2</div><div class="crayon-num" data-line="crayon-5593a443dfd67-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfd67-4">4</div><div class="crayon-num" data-line="crayon-5593a443dfd67-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfd67-6">6</div><div class="crayon-num" data-line="crayon-5593a443dfd67-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfd67-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443dfd67-1"><span class="crayon-p"># fdisk -l</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfd67-2"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5593a443dfd67-3"><span class="crayon-i">Disk</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">dev</span><span class="crayon-o">/</span><span class="crayon-i">vdb</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">2147</span><span class="crayon-h"> </span><span class="crayon-i">MB</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2147483648</span><span class="crayon-h"> </span><span class="crayon-i">bytes</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfd67-4"><span class="crayon-cn">16</span><span class="crayon-h"> </span><span class="crayon-i">heads</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">63</span><span class="crayon-h"> </span><span class="crayon-i">sectors</span><span class="crayon-o">/</span><span class="crayon-i">track</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">4161</span><span class="crayon-h"> </span><span class="crayon-e">cylinders</span></div><div class="crayon-line" id="crayon-5593a443dfd67-5"><span class="crayon-v">Units</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">cylinders </span><span class="crayon-i">of</span><span class="crayon-h"> </span><span class="crayon-cn">1008</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">512</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">516096</span><span class="crayon-h"> </span><span class="crayon-e">bytes</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfd67-6"><span class="crayon-e">Sector </span><span class="crayon-e">size</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">logical</span><span class="crayon-o">/</span><span class="crayon-i">physical</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">512</span><span class="crayon-h"> </span><span class="crayon-i">bytes</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">512</span><span class="crayon-h"> </span><span class="crayon-i">bytes</span></div><div class="crayon-line" id="crayon-5593a443dfd67-7"><span class="crayon-i">I</span><span class="crayon-o">/</span><span class="crayon-i">O</span><span class="crayon-h"> </span><span class="crayon-e">size</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">minimum</span><span class="crayon-o">/</span><span class="crayon-i">optimal</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">512</span><span class="crayon-h"> </span><span class="crayon-i">bytes</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">512</span><span class="crayon-h"> </span><span class="crayon-e">bytes</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfd67-8"><span class="crayon-e">Disk </span><span class="crayon-i">identifier</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0x00000000</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0044 seconds] -->
<p>Next, I partitioned the entire disk as type<code><strong> 8e</strong> </code>(Linux LVM), created a new physical volume using the new partition (<code><strong>/dev/vdb1</strong></code>), a new volume group using that PV (<code><strong>vg_data</strong></code>) and then a 1GB logical volume within the new volume group – <code><strong>lv_data_01</strong></code>:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443dfdc5" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># sfdisk /dev/vdb &lt;&lt;_EOF_
&gt; 0,,8e
&gt; _EOF_
# pvcreate /dev/vdb1
# vgcreate vg_data /dev/vdb1
# lvcreate -L 1G -n lv_data_01 vg_data</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443dfdc5-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfdc5-2">2</div><div class="crayon-num" data-line="crayon-5593a443dfdc5-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfdc5-4">4</div><div class="crayon-num" data-line="crayon-5593a443dfdc5-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfdc5-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443dfdc5-1"><span class="crayon-p"># sfdisk /dev/vdb &lt;&lt;_EOF_</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfdc5-2"><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-sy">,</span><span class="crayon-cn">8e</span></div><div class="crayon-line" id="crayon-5593a443dfdc5-3"><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-i">_EOF_</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfdc5-4"><span class="crayon-p"># pvcreate /dev/vdb1</span></div><div class="crayon-line" id="crayon-5593a443dfdc5-5"><span class="crayon-p"># vgcreate vg_data /dev/vdb1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfdc5-6"><span class="crayon-p"># lvcreate -L 1G -n lv_data_01 vg_data</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>This 1GB volume will be used for the DRBD replicated storage volume on each node. We can now move on to software package installation.</p>
<h1>Package Installation</h1>
<p>I installed <code><strong>pacemaker</strong></code> and <code><strong>corosync</strong></code> from the standard CentOS repositories:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443dfe2c" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># yum -y install corosync pacemaker</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443dfe2c-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443dfe2c-1"><span class="crayon-p"># yum -y install corosync pacemaker</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>However, between CentOS 6.3 and 6.4 being released, <code><strong>pacemaker</strong></code> has been updated from 1.1.7 to 1.1.8, which means that the CRM shell is no longer included. This is now maintained in its own project – <code><strong>crmsh</strong></code> – and CentOS 6 RPMs are available via the OpenSUSE package repositories.</p>
<p>So, I installed <code><strong>crmsh</strong></code> by way of its dependencies:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443dfe88" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># yum -y install python-dateutil redhat-rpm-config
# rpm -ivh http://download.opensuse.org/repositories/network:/ha-clustering/CentOS_CentOS-6/x86_64/pssh-2.3.1-15.1.x86_64.rpm
# rpm -ivh http://download.opensuse.org/repositories/network:/ha-clustering/CentOS_CentOS-6/x86_64/crmsh-1.2.5-55.6.x86_64.rpm</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443dfe88-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfe88-2">2</div><div class="crayon-num" data-line="crayon-5593a443dfe88-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443dfe88-1"><span class="crayon-p"># yum -y install python-dateutil redhat-rpm-config</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfe88-2"><span class="crayon-p"># rpm -ivh http://download.opensuse.org/repositories/network:/ha-clustering/CentOS_CentOS-6/x86_64/pssh-2.3.1-15.1.x86_64.rpm</span></div><div class="crayon-line" id="crayon-5593a443dfe88-3"><span class="crayon-p"># rpm -ivh http://download.opensuse.org/repositories/network:/ha-clustering/CentOS_CentOS-6/x86_64/crmsh-1.2.5-55.6.x86_64.rpm</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Next, I installed DRBD 8.4 from the ELrepo repository:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443dfea2" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># rpm --import http://elrepo.org/RPM-GPG-KEY-elrepo.org
# rpm -Uvh http://elrepo.org/elrepo-release-6-5.el6.elrepo.noarch.rpm
# yum -y install drbd84-utils kmod-drbd84</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443dfea2-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dfea2-2">2</div><div class="crayon-num" data-line="crayon-5593a443dfea2-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443dfea2-1"><span class="crayon-p"># rpm --import http://elrepo.org/RPM-GPG-KEY-elrepo.org</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dfea2-2"><span class="crayon-p"># rpm -Uvh http://elrepo.org/elrepo-release-6-5.el6.elrepo.noarch.rpm</span></div><div class="crayon-line" id="crayon-5593a443dfea2-3"><span class="crayon-p"># yum -y install drbd84-utils kmod-drbd84</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>I then ensured that it wasn’t set to start automatically at boot (as the cluster will manage this):</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443dfef4" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># chkconfig drbd off</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443dfef4-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443dfef4-1"><span class="crayon-p"># chkconfig drbd off</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>I left nginx package installation for later in the procedure.</p>
<h1>Corosync Configuration</h1>
<p>As I’m using KVM guests, and multicast is particularly troublesome over the bridged interface (and I didn’t want to hassle with <code><strong>smcroute</strong></code>, or similar, to set up multicast routing) I used unicast for cluster communications. A sample unicast configuration file is included at <code><strong>/etc/corosync/corosync.conf.example.udpu</strong></code>. I took that file and edited as follows:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443dff49" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># cp -p /etc/corosync/corosync.conf.example.udpu /etc/corosync/corosync.conf
# vi /etc/corosync/corosync.conf
compatibility: whitetank

totem {
	version: 2
	secauth: on
	interface {
		member {
			memberaddr: 192.168.122.30
		}
		member {
			memberaddr: 192.168.122.31
		}
		ringnumber: 0
		bindnetaddr: 192.168.122.30
		mcastport: 5405
		ttl: 1
	}
	transport: udpu
}

logging {
	fileline: off
	to_logfile: yes
	to_syslog: yes
	debug: on
	logfile: /var/log/cluster/corosync.log
	debug: off
	timestamp: on
	logger_subsys {
		subsys: AMF
		debug: off
	}
}</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -25px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443dff49-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-2">2</div><div class="crayon-num" data-line="crayon-5593a443dff49-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-4">4</div><div class="crayon-num" data-line="crayon-5593a443dff49-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-6">6</div><div class="crayon-num" data-line="crayon-5593a443dff49-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-8">8</div><div class="crayon-num" data-line="crayon-5593a443dff49-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-10">10</div><div class="crayon-num" data-line="crayon-5593a443dff49-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-12">12</div><div class="crayon-num" data-line="crayon-5593a443dff49-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-14">14</div><div class="crayon-num" data-line="crayon-5593a443dff49-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-16">16</div><div class="crayon-num" data-line="crayon-5593a443dff49-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-18">18</div><div class="crayon-num" data-line="crayon-5593a443dff49-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-20">20</div><div class="crayon-num" data-line="crayon-5593a443dff49-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-22">22</div><div class="crayon-num" data-line="crayon-5593a443dff49-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-24">24</div><div class="crayon-num" data-line="crayon-5593a443dff49-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-26">26</div><div class="crayon-num" data-line="crayon-5593a443dff49-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-28">28</div><div class="crayon-num" data-line="crayon-5593a443dff49-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-30">30</div><div class="crayon-num" data-line="crayon-5593a443dff49-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-32">32</div><div class="crayon-num" data-line="crayon-5593a443dff49-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff49-34">34</div><div class="crayon-num" data-line="crayon-5593a443dff49-35">35</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443dff49-1"><span class="crayon-p"># cp -p /etc/corosync/corosync.conf.example.udpu /etc/corosync/corosync.conf</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-2"><span class="crayon-p"># vi /etc/corosync/corosync.conf</span></div><div class="crayon-line" id="crayon-5593a443dff49-3"><span class="crayon-i">compatibility</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">whitetank</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-4">&nbsp;</div><div class="crayon-line" id="crayon-5593a443dff49-5"><span class="crayon-e">totem</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">version</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-5593a443dff49-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">secauth</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">on</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">interface</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5593a443dff49-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">member</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">memberaddr</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.122.30</span></div><div class="crayon-line" id="crayon-5593a443dff49-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">member</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5593a443dff49-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">memberaddr</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.122.31</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5593a443dff49-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">ringnumber</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">bindnetaddr</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.122.30</span></div><div class="crayon-line" id="crayon-5593a443dff49-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">mcastport</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">5405</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">ttl</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5593a443dff49-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">transport</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">udpu</span></div><div class="crayon-line" id="crayon-5593a443dff49-21"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-22">&nbsp;</div><div class="crayon-line" id="crayon-5593a443dff49-23"><span class="crayon-e">logging</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">fileline</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">off</span></div><div class="crayon-line" id="crayon-5593a443dff49-25"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">to_logfile</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">yes</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-26"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">to_syslog</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">yes</span></div><div class="crayon-line" id="crayon-5593a443dff49-27"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">debug</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">on</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-28"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">logfile</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-t">var</span><span class="crayon-o">/</span><span class="crayon-i">log</span><span class="crayon-o">/</span><span class="crayon-i">cluster</span><span class="crayon-o">/</span><span class="crayon-v">corosync</span><span class="crayon-e">.log</span></div><div class="crayon-line" id="crayon-5593a443dff49-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">debug</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">off</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-30"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">timestamp</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">on</span></div><div class="crayon-line" id="crayon-5593a443dff49-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">logger_subsys</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">subsys</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">AMF</span></div><div class="crayon-line" id="crayon-5593a443dff49-33"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">debug</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">off</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff49-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5593a443dff49-35"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0053 seconds] -->
<p>Next, I created a service definition for the Pacemaker resource manager that we’ll be using:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443dff9f" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># vi /etc/corosync/service.d/pcmk
service {
        # Load the Pacemaker Cluster Resource Manager
        name: pacemaker
        ver: 1
}</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443dff9f-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff9f-2">2</div><div class="crayon-num" data-line="crayon-5593a443dff9f-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff9f-4">4</div><div class="crayon-num" data-line="crayon-5593a443dff9f-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443dff9f-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443dff9f-1"><span class="crayon-p"># vi /etc/corosync/service.d/pcmk</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff9f-2"><span class="crayon-e">service</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5593a443dff9f-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># Load the Pacemaker Cluster Resource Manager</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff9f-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">name</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">pacemaker</span></div><div class="crayon-line" id="crayon-5593a443dff9f-5"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">ver</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443dff9f-6"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>As I’d changed <code><strong>secauth</strong></code> to <code><strong>on</strong></code> (it was <code><strong>off</strong></code> in the example), I then needed to create a key to encrypt cluster communications and distribute that around the cluster. On the first node:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443dfff1" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># corosync-keygen</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443dfff1-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443dfff1-1"><span class="crayon-p"># corosync-keygen</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>This command will sit waiting for entropy to be generated. A quick way of doing this is to ssh in to the node via another session and run</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0044" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># find / &gt;/dev/null 2&gt;&amp;1</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0044-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0044-1"><span class="crayon-p"># find / &gt;/dev/null 2&gt;&amp;1</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>a few times. Once the key is generated, it’ll be available at<code><strong> /etc/corosync/authkey</strong></code>. Copy it to the other cluster node, and secure it:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0097" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># scp /etc/corosync/authkey root@rhcs-node02:/etc/corosync
# chmod 400 /etc/corosync/authkey</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0097-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0097-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0097-1"><span class="crayon-p"># scp /etc/corosync/authkey root@rhcs-node02:/etc/corosync</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0097-2"><span class="crayon-p"># chmod 400 /etc/corosync/authkey</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Now, we can start our bare-bones cluster:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e00eb" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># service corosync start
# service pacemaker start</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e00eb-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e00eb-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e00eb-1"><span class="crayon-p"># service corosync start</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e00eb-2"><span class="crayon-p"># service pacemaker start</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>And verify the status:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e014b" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm status
Last updated: Thu Jun 13 01:15:24 2013
Last change: Thu Jun 13 01:07:57 2013 via crmd on rhcs-node01.local
Stack: classic openais (with plugin)
Current DC: rhcs-node01.local - partition with quorum
Version: 1.1.8-7.el6-394e906
2 Nodes configured, 2 expected votes
0 Resources configured.

Online: [ rhcs-node01.local rhcs-node02.local ]</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -25px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e014b-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e014b-2">2</div><div class="crayon-num" data-line="crayon-5593a443e014b-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e014b-4">4</div><div class="crayon-num" data-line="crayon-5593a443e014b-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e014b-6">6</div><div class="crayon-num" data-line="crayon-5593a443e014b-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e014b-8">8</div><div class="crayon-num" data-line="crayon-5593a443e014b-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e014b-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e014b-1"><span class="crayon-p"># crm status</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e014b-2"><span class="crayon-e">Last </span><span class="crayon-i">updated</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Thu </span><span class="crayon-i">Jun</span><span class="crayon-h"> </span><span class="crayon-cn">13</span><span class="crayon-h"> </span><span class="crayon-cn">01</span><span class="crayon-o">:</span><span class="crayon-cn">15</span><span class="crayon-o">:</span><span class="crayon-cn">24</span><span class="crayon-h"> </span><span class="crayon-cn">2013</span></div><div class="crayon-line" id="crayon-5593a443e014b-3"><span class="crayon-e">Last </span><span class="crayon-i">change</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Thu </span><span class="crayon-i">Jun</span><span class="crayon-h"> </span><span class="crayon-cn">13</span><span class="crayon-h"> </span><span class="crayon-cn">01</span><span class="crayon-o">:</span><span class="crayon-cn">07</span><span class="crayon-o">:</span><span class="crayon-cn">57</span><span class="crayon-h"> </span><span class="crayon-cn">2013</span><span class="crayon-h"> </span><span class="crayon-e">via </span><span class="crayon-e">crmd </span><span class="crayon-e">on </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e014b-4"><span class="crayon-i">Stack</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">classic </span><span class="crayon-e">openais</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">with </span><span class="crayon-i">plugin</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5593a443e014b-5"><span class="crayon-e">Current </span><span class="crayon-i">DC</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">partition </span><span class="crayon-e">with </span><span class="crayon-e">quorum</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e014b-6"><span class="crayon-i">Version</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1.1.8</span><span class="crayon-o">-</span><span class="crayon-cn">7.el6</span><span class="crayon-o">-</span><span class="crayon-cn">394e906</span></div><div class="crayon-line" id="crayon-5593a443e014b-7"><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-e">Nodes </span><span class="crayon-i">configured</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-e">expected </span><span class="crayon-i">votes</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e014b-8"><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-e">Resources </span><span class="crayon-v">configured</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5593a443e014b-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e014b-10"><span class="crayon-i">Online</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0038 seconds] -->
<p>Awesome. The cluster is running. A quick check via the <code><strong>crm</strong></code> shell shows that there isn’t much to the configuration at this point:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e01a0" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm configure show
node rhcs-node01.local
node rhcs-node02.local
property $id="cib-bootstrap-options" \
    dc-version="1.1.8-7.el6-394e906" \
    cluster-infrastructure="classic openais (with plugin)" \
    expected-quorum-votes="2"</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e01a0-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01a0-2">2</div><div class="crayon-num" data-line="crayon-5593a443e01a0-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01a0-4">4</div><div class="crayon-num" data-line="crayon-5593a443e01a0-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01a0-6">6</div><div class="crayon-num" data-line="crayon-5593a443e01a0-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e01a0-1"><span class="crayon-p"># crm configure show</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01a0-2"><span class="crayon-e">node </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span></div><div class="crayon-line" id="crayon-5593a443e01a0-3"><span class="crayon-e">node </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01a0-4"><span class="crayon-i">property</span><span class="crayon-h"> </span><span class="crayon-v">$id</span><span class="crayon-o">=</span><span class="crayon-s">"cib-bootstrap-options"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e01a0-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">dc</span><span class="crayon-o">-</span><span class="crayon-v">version</span><span class="crayon-o">=</span><span class="crayon-s">"1.1.8-7.el6-394e906"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01a0-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">cluster</span><span class="crayon-o">-</span><span class="crayon-v">infrastructure</span><span class="crayon-o">=</span><span class="crayon-s">"classic openais (with plugin)"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e01a0-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">expected</span><span class="crayon-o">-</span><span class="crayon-i">quorum</span><span class="crayon-o">-</span><span class="crayon-v">votes</span><span class="crayon-o">=</span><span class="crayon-s">"2"</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0018 seconds] -->
<p></p>
<h1>DRBD Configuration</h1>
<p>The next piece of the puzzle is to configure the replicated storage volume. On both nodes, take a backup of <code><strong>/etc/drbd.conf</strong></code> (which itself includes files under<code><strong> /etc/drbd.d</strong> </code>- I’ll just use <code><strong>/etc/drbd.conf</strong></code>) and edit as follows. As you can see, I have commented the configuration file directives very well, so will not explain them in this text apart from saying that the LVM logical volume at <code><strong>/dev/vg_data/lv_data_01</strong></code> created earlier is used as our backing store device, and the new DRBD volume will be available at <code><strong>/dev/drbd0</strong></code>:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e01ff" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># cp -p /etc/drbd.conf /etc/drbd.conf-orig
# vi /etc/drbd.conf
# see http://www.drbd.org/users-guide/re-drbdconf.html
global {
	# do not participate in online usage survey
	usage-count no;
}

resource data {

	# write IO is reported as completed if it has reached both local
	# and remote disk
	protocol C;

	net {
		# set up peer authentication
		cram-hmac-alg sha1;
		shared-secret "s3cr3tp@ss";
		# default value 32 - increase as required
		max-buffers 512;
		# highest number of data blocks between two write barriers
		max-epoch-size 512;
		# size of the TCP socket send buffer - can tweak or set to 0 to
		# allow kernel to autotune
		sndbuf-size 0;
	}

	startup {
		# wait for connection timeout - boot process blocked
		# until DRBD resources are connected
		wfc-timeout 30;
		# WFC timeout if peer was outdated
		outdated-wfc-timeout 20;
		# WFC timeout if this node was in a degraded cluster (i.e. only had one
		# node left)
		degr-wfc-timeout 30;
	}

	disk {
		# the next two are for safety - detach on I/O error
		# and set up fencing - resource-only will attempt to
		# reach the other node and fence via the fence-peer 
		# handler
		on-io-error detach;
		fencing resource-only; 
		# no-disk-flushes; # if we had battery-backed RAID
		# no-md-flushes; # if we had battery-backed RAID
		# ramp up the resync rate
		resync-rate 10M;
	}
	handlers {
		# specify the two fencing handlers
		# see: http://www.drbd.org/users-guide-8.4/s-pacemaker-fencing.html
		fence-peer "/usr/lib/drbd/crm-fence-peer.sh";
		after-resync-target "/usr/lib/drbd/crm-unfence-peer.sh";
	}
	# first node
	on rhcs-node01.local {
		# DRBD device
		device /dev/drbd0;
		# backing store device
		disk /dev/vg_data/lv_data_01;
		# IP address of node, and port to listen on
		address 192.168.122.30:7789;
		# use internal meta data (don't create a filesystem before 
		# you create metadata!)
		meta-disk internal;
	}
	# second node
	on rhcs-node02.local {
		# DRBD debice
		device /dev/drbd0;
		# backing store device
		disk /dev/vg_data/lv_data_01;
		# IP address of node, and port to listen on
		address 192.168.122.31:7789;
		# use internal meta data (don't create a filesystem before
		# you create metadata!)
		meta-disk internal;
	}
}</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -25px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e01ff-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-2">2</div><div class="crayon-num" data-line="crayon-5593a443e01ff-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-4">4</div><div class="crayon-num" data-line="crayon-5593a443e01ff-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-6">6</div><div class="crayon-num" data-line="crayon-5593a443e01ff-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-8">8</div><div class="crayon-num" data-line="crayon-5593a443e01ff-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-10">10</div><div class="crayon-num" data-line="crayon-5593a443e01ff-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-12">12</div><div class="crayon-num" data-line="crayon-5593a443e01ff-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-14">14</div><div class="crayon-num" data-line="crayon-5593a443e01ff-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-16">16</div><div class="crayon-num" data-line="crayon-5593a443e01ff-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-18">18</div><div class="crayon-num" data-line="crayon-5593a443e01ff-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-20">20</div><div class="crayon-num" data-line="crayon-5593a443e01ff-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-22">22</div><div class="crayon-num" data-line="crayon-5593a443e01ff-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-24">24</div><div class="crayon-num" data-line="crayon-5593a443e01ff-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-26">26</div><div class="crayon-num" data-line="crayon-5593a443e01ff-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-28">28</div><div class="crayon-num" data-line="crayon-5593a443e01ff-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-30">30</div><div class="crayon-num" data-line="crayon-5593a443e01ff-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-32">32</div><div class="crayon-num" data-line="crayon-5593a443e01ff-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-34">34</div><div class="crayon-num" data-line="crayon-5593a443e01ff-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-36">36</div><div class="crayon-num" data-line="crayon-5593a443e01ff-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-38">38</div><div class="crayon-num" data-line="crayon-5593a443e01ff-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-40">40</div><div class="crayon-num" data-line="crayon-5593a443e01ff-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-42">42</div><div class="crayon-num" data-line="crayon-5593a443e01ff-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-44">44</div><div class="crayon-num" data-line="crayon-5593a443e01ff-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-46">46</div><div class="crayon-num" data-line="crayon-5593a443e01ff-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-48">48</div><div class="crayon-num" data-line="crayon-5593a443e01ff-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-50">50</div><div class="crayon-num" data-line="crayon-5593a443e01ff-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-52">52</div><div class="crayon-num" data-line="crayon-5593a443e01ff-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-54">54</div><div class="crayon-num" data-line="crayon-5593a443e01ff-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-56">56</div><div class="crayon-num" data-line="crayon-5593a443e01ff-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-58">58</div><div class="crayon-num" data-line="crayon-5593a443e01ff-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-60">60</div><div class="crayon-num" data-line="crayon-5593a443e01ff-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-62">62</div><div class="crayon-num" data-line="crayon-5593a443e01ff-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-64">64</div><div class="crayon-num" data-line="crayon-5593a443e01ff-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-66">66</div><div class="crayon-num" data-line="crayon-5593a443e01ff-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-68">68</div><div class="crayon-num" data-line="crayon-5593a443e01ff-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-70">70</div><div class="crayon-num" data-line="crayon-5593a443e01ff-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-72">72</div><div class="crayon-num" data-line="crayon-5593a443e01ff-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-74">74</div><div class="crayon-num" data-line="crayon-5593a443e01ff-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-76">76</div><div class="crayon-num" data-line="crayon-5593a443e01ff-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-78">78</div><div class="crayon-num" data-line="crayon-5593a443e01ff-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e01ff-80">80</div><div class="crayon-num" data-line="crayon-5593a443e01ff-81">81</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e01ff-1"><span class="crayon-p"># cp -p /etc/drbd.conf /etc/drbd.conf-orig</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-2"><span class="crayon-p"># vi /etc/drbd.conf</span></div><div class="crayon-line" id="crayon-5593a443e01ff-3"><span class="crayon-p"># see http://www.drbd.org/users-guide/re-drbdconf.html</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-4"><span class="crayon-e">global</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5593a443e01ff-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># do not participate in online usage survey</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">usage</span><span class="crayon-o">-</span><span class="crayon-e">count </span><span class="crayon-i">no</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e01ff-7"><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-8">&nbsp;</div><div class="crayon-line" id="crayon-5593a443e01ff-9"><span class="crayon-e">resource</span><span class="crayon-h"> </span><span class="crayon-e">data</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-10">&nbsp;</div><div class="crayon-line" id="crayon-5593a443e01ff-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># write IO is reported as completed if it has reached both local</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># and remote disk</span></div><div class="crayon-line" id="crayon-5593a443e01ff-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">protocol</span><span class="crayon-h"> </span><span class="crayon-i">C</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-14">&nbsp;</div><div class="crayon-line" id="crayon-5593a443e01ff-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">net</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># set up peer authentication</span></div><div class="crayon-line" id="crayon-5593a443e01ff-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">cram</span><span class="crayon-o">-</span><span class="crayon-i">hmac</span><span class="crayon-o">-</span><span class="crayon-e">alg </span><span class="crayon-i">sha1</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">shared</span><span class="crayon-o">-</span><span class="crayon-i">secret</span><span class="crayon-h"> </span><span class="crayon-s">"s3cr3tp@ss"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e01ff-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># default value 32 - increase as required</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">max</span><span class="crayon-o">-</span><span class="crayon-i">buffers</span><span class="crayon-h"> </span><span class="crayon-cn">512</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e01ff-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># highest number of data blocks between two write barriers</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">max</span><span class="crayon-o">-</span><span class="crayon-i">epoch</span><span class="crayon-o">-</span><span class="crayon-i">size</span><span class="crayon-h"> </span><span class="crayon-cn">512</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e01ff-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># size of the TCP socket send buffer - can tweak or set to 0 to</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># allow kernel to autotune</span></div><div class="crayon-line" id="crayon-5593a443e01ff-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">sndbuf</span><span class="crayon-o">-</span><span class="crayon-i">size</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5593a443e01ff-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">startup</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5593a443e01ff-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># wait for connection timeout - boot process blocked</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># until DRBD resources are connected</span></div><div class="crayon-line" id="crayon-5593a443e01ff-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">wfc</span><span class="crayon-o">-</span><span class="crayon-i">timeout</span><span class="crayon-h"> </span><span class="crayon-cn">30</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># WFC timeout if peer was outdated</span></div><div class="crayon-line" id="crayon-5593a443e01ff-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">outdated</span><span class="crayon-o">-</span><span class="crayon-i">wfc</span><span class="crayon-o">-</span><span class="crayon-i">timeout</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># WFC timeout if this node was in a degraded cluster (i.e. only had one</span></div><div class="crayon-line" id="crayon-5593a443e01ff-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># node left)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">degr</span><span class="crayon-o">-</span><span class="crayon-i">wfc</span><span class="crayon-o">-</span><span class="crayon-i">timeout</span><span class="crayon-h"> </span><span class="crayon-cn">30</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e01ff-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-38">&nbsp;</div><div class="crayon-line" id="crayon-5593a443e01ff-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">disk</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># the next two are for safety - detach on I/O error</span></div><div class="crayon-line" id="crayon-5593a443e01ff-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># and set up fencing - resource-only will attempt to</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># reach the other node and fence via the fence-peer </span></div><div class="crayon-line" id="crayon-5593a443e01ff-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># handler</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">on</span><span class="crayon-o">-</span><span class="crayon-i">io</span><span class="crayon-o">-</span><span class="crayon-e">error </span><span class="crayon-i">detach</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e01ff-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">fencing </span><span class="crayon-i">resource</span><span class="crayon-o">-</span><span class="crayon-i">only</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># no-disk-flushes; # if we had battery-backed RAID</span></div><div class="crayon-line" id="crayon-5593a443e01ff-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># no-md-flushes; # if we had battery-backed RAID</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># ramp up the resync rate</span></div><div class="crayon-line" id="crayon-5593a443e01ff-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">resync</span><span class="crayon-o">-</span><span class="crayon-i">rate</span><span class="crayon-h"> </span><span class="crayon-cn">10M</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5593a443e01ff-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">handlers</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># specify the two fencing handlers</span></div><div class="crayon-line" id="crayon-5593a443e01ff-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># see: http://www.drbd.org/users-guide-8.4/s-pacemaker-fencing.html</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">fence</span><span class="crayon-o">-</span><span class="crayon-i">peer</span><span class="crayon-h"> </span><span class="crayon-s">"/usr/lib/drbd/crm-fence-peer.sh"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e01ff-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">after</span><span class="crayon-o">-</span><span class="crayon-i">resync</span><span class="crayon-o">-</span><span class="crayon-i">target</span><span class="crayon-h"> </span><span class="crayon-s">"/usr/lib/drbd/crm-unfence-peer.sh"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5593a443e01ff-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># first node</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">on </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5593a443e01ff-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># DRBD device</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">device</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">dev</span><span class="crayon-o">/</span><span class="crayon-i">drbd0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e01ff-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># backing store device</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">disk</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">dev</span><span class="crayon-o">/</span><span class="crayon-i">vg_data</span><span class="crayon-o">/</span><span class="crayon-i">lv_data_01</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e01ff-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># IP address of node, and port to listen on</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">address</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.122.30</span><span class="crayon-o">:</span><span class="crayon-cn">7789</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e01ff-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># use internal meta data (don't create a filesystem before </span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># you create metadata!)</span></div><div class="crayon-line" id="crayon-5593a443e01ff-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">meta</span><span class="crayon-o">-</span><span class="crayon-e">disk </span><span class="crayon-i">internal</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5593a443e01ff-69"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># second node</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-70"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">on </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5593a443e01ff-71"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># DRBD debice</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">device</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">dev</span><span class="crayon-o">/</span><span class="crayon-i">drbd0</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e01ff-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># backing store device</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">disk</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">dev</span><span class="crayon-o">/</span><span class="crayon-i">vg_data</span><span class="crayon-o">/</span><span class="crayon-i">lv_data_01</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e01ff-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># IP address of node, and port to listen on</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">address</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.122.31</span><span class="crayon-o">:</span><span class="crayon-cn">7789</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e01ff-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># use internal meta data (don't create a filesystem before</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p"># you create metadata!)</span></div><div class="crayon-line" id="crayon-5593a443e01ff-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">meta</span><span class="crayon-o">-</span><span class="crayon-e">disk </span><span class="crayon-i">internal</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e01ff-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5593a443e01ff-81"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0107 seconds] -->
<p>On both nodes, create the DRBD metadata:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0268" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># drbdadm create-md data</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0268-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0268-1"><span class="crayon-p"># drbdadm create-md data</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>You can use a separate volume for metadata, but if you’ve not yet created a filesystem you can use internal metadata as is the case above. You may also opt to use a separate volume for metadata for performance reasons. You can read the <a href="http://www.drbd.org/users-guide/ch-internals.html">DRBD Internals page</a> for more information on that. For most simple applications, internal metadata will suffice.</p>
<p>Start the DRBD service on both nodes (remembering that we will be shutting it down again as it will be cluster managed):</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e02c1" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># service drbd start</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e02c1-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e02c1-1"><span class="crayon-p"># service drbd start</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>On the MASTER NODE only, promote the volume to the primary role:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0315" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># drbdadm primary --force data</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0315-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0315-1"><span class="crayon-p"># drbdadm primary --force data</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Note that in DRBD versions &lt;8.4 (e.g. 8.3) you will need to use a different command:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0368" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># drbdadm -- --overwrite-data-of-peer primary data</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0368-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0368-1"><span class="crayon-p"># drbdadm -- --overwrite-data-of-peer primary data</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>You can<code><strong> cat /proc/drbd</strong> </code>to watch the synchronisation operation in progress:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e03bd" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># cat /proc/drbd 
version: 8.4.2 (api:1/proto:86-101)
GIT-hash: 7ad5f850d711223713d6dcadc3dd48860321070c build by dag@Build64R6, 2012-09-06 08:16:10
 0: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r-----
    ns:1048508 nr:0 dw:0 dr:1049172 al:0 bm:64 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:0</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e03bd-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e03bd-2">2</div><div class="crayon-num" data-line="crayon-5593a443e03bd-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e03bd-4">4</div><div class="crayon-num" data-line="crayon-5593a443e03bd-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e03bd-1"><span class="crayon-p"># cat /proc/drbd </span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e03bd-2"><span class="crayon-i">version</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">8.4.2</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">api</span><span class="crayon-o">:</span><span class="crayon-cn">1</span><span class="crayon-o">/</span><span class="crayon-i">proto</span><span class="crayon-o">:</span><span class="crayon-cn">86</span><span class="crayon-o">-</span><span class="crayon-cn">101</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5593a443e03bd-3"><span class="crayon-i">GIT</span><span class="crayon-o">-</span><span class="crayon-r">hash</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">7ad5f850d711223713d6dcadc3dd48860321070c</span><span class="crayon-h"> </span><span class="crayon-e">build </span><span class="crayon-e">by </span><span class="crayon-i">dag</span><span class="crayon-sy">@</span><span class="crayon-i">Build64R6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2012</span><span class="crayon-o">-</span><span class="crayon-cn">09</span><span class="crayon-o">-</span><span class="crayon-cn">06</span><span class="crayon-h"> </span><span class="crayon-cn">08</span><span class="crayon-o">:</span><span class="crayon-cn">16</span><span class="crayon-o">:</span><span class="crayon-cn">10</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e03bd-4"><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">cs</span><span class="crayon-o">:</span><span class="crayon-e">Connected </span><span class="crayon-i">ro</span><span class="crayon-o">:</span><span class="crayon-i">Primary</span><span class="crayon-o">/</span><span class="crayon-e">Secondary </span><span class="crayon-i">ds</span><span class="crayon-o">:</span><span class="crayon-i">UpToDate</span><span class="crayon-o">/</span><span class="crayon-i">UpToDate</span><span class="crayon-h"> </span><span class="crayon-i">C</span><span class="crayon-h"> </span><span class="crayon-i">r</span><span class="crayon-o">--</span><span class="crayon-o">--</span><span class="crayon-o">-</span></div><div class="crayon-line" id="crayon-5593a443e03bd-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">ns</span><span class="crayon-o">:</span><span class="crayon-cn">1048508</span><span class="crayon-h"> </span><span class="crayon-i">nr</span><span class="crayon-o">:</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-i">dw</span><span class="crayon-o">:</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-i">dr</span><span class="crayon-o">:</span><span class="crayon-cn">1049172</span><span class="crayon-h"> </span><span class="crayon-i">al</span><span class="crayon-o">:</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-i">bm</span><span class="crayon-o">:</span><span class="crayon-cn">64</span><span class="crayon-h"> </span><span class="crayon-i">lo</span><span class="crayon-o">:</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-i">pe</span><span class="crayon-o">:</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-i">ua</span><span class="crayon-o">:</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-i">ap</span><span class="crayon-o">:</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-i">ep</span><span class="crayon-o">:</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-i">wo</span><span class="crayon-o">:</span><span class="crayon-i">f</span><span class="crayon-h"> </span><span class="crayon-i">oos</span><span class="crayon-o">:</span><span class="crayon-cn">0</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0039 seconds] -->
<p>Or, run <code><strong>service drbd status</strong></code>:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0410" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># service drbd status
drbd driver loaded OK; device status:
version: 8.4.2 (api:1/proto:86-101)
GIT-hash: 7ad5f850d711223713d6dcadc3dd48860321070c build by dag@Build64R6, 2012-09-06 08:16:10
m:res   cs         ro                 ds                 p  mounted  fstype
0:data  Connected  Primary/Secondary  UpToDate/UpToDate  C</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0410-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0410-2">2</div><div class="crayon-num" data-line="crayon-5593a443e0410-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0410-4">4</div><div class="crayon-num" data-line="crayon-5593a443e0410-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0410-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0410-1"><span class="crayon-p"># service drbd status</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0410-2"><span class="crayon-e">drbd </span><span class="crayon-e">driver </span><span class="crayon-e">loaded </span><span class="crayon-i">OK</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-e">device </span><span class="crayon-i">status</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5593a443e0410-3"><span class="crayon-i">version</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">8.4.2</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">api</span><span class="crayon-o">:</span><span class="crayon-cn">1</span><span class="crayon-o">/</span><span class="crayon-i">proto</span><span class="crayon-o">:</span><span class="crayon-cn">86</span><span class="crayon-o">-</span><span class="crayon-cn">101</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0410-4"><span class="crayon-i">GIT</span><span class="crayon-o">-</span><span class="crayon-r">hash</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">7ad5f850d711223713d6dcadc3dd48860321070c</span><span class="crayon-h"> </span><span class="crayon-e">build </span><span class="crayon-e">by </span><span class="crayon-i">dag</span><span class="crayon-sy">@</span><span class="crayon-i">Build64R6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2012</span><span class="crayon-o">-</span><span class="crayon-cn">09</span><span class="crayon-o">-</span><span class="crayon-cn">06</span><span class="crayon-h"> </span><span class="crayon-cn">08</span><span class="crayon-o">:</span><span class="crayon-cn">16</span><span class="crayon-o">:</span><span class="crayon-cn">10</span></div><div class="crayon-line" id="crayon-5593a443e0410-5"><span class="crayon-i">m</span><span class="crayon-o">:</span><span class="crayon-e">res&nbsp;&nbsp; </span><span class="crayon-e">cs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">ro&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">ds</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">p</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-e">mounted&nbsp;&nbsp;</span><span class="crayon-i">fstype</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0410-6"><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-e">data&nbsp;&nbsp;</span><span class="crayon-e">Connected&nbsp;&nbsp;</span><span class="crayon-i">Primary</span><span class="crayon-o">/</span><span class="crayon-e">Secondary&nbsp;&nbsp;</span><span class="crayon-i">UpToDate</span><span class="crayon-o">/</span><span class="crayon-i">UpToDate</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-i">C</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0028 seconds] -->
<p>On both nodes, create the mountpoint for the DRBD-replicated volume, which in our case will be <code><strong>/data</strong></code>. It is needless to say (but I’ll say it anyway) that this volume will be only ever mounted from a single node at a time.</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0463" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># mkdir /data</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0463-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0463-1"><span class="crayon-p"># mkdir /data</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>From the MASTER NODE, create an <code><strong>ext4</strong></code> filesystem and <code><strong>mount/umount</strong> </code>the new filesystem to test. Ensure that you use<code><strong> /dev/drbd0</strong></code> – i.e. the DRBD device – not the backing store device:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e04b6" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># mkfs.ext4 /dev/drbd0
# mount /dev/drbd0 /data
# umount /data</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e04b6-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e04b6-2">2</div><div class="crayon-num" data-line="crayon-5593a443e04b6-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e04b6-1"><span class="crayon-p"># mkfs.ext4 /dev/drbd0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e04b6-2"><span class="crayon-p"># mount /dev/drbd0 /data</span></div><div class="crayon-line" id="crayon-5593a443e04b6-3"><span class="crayon-p"># umount /data</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Now, on both nodes, stop DRBD:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0509" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># service drbd stop</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0509-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0509-1"><span class="crayon-p"># service drbd stop</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>We have our storage. Next, the murky world of the cluster resource manager.</p>
<h1>Cluster Resource Configuration</h1>
<p>Whilst there is lots of documentation available (both in articles like mine, and the excellent (and definitive) documentation at <a href="http://clusterlabs.org/">clusterlabs.org</a> such as <a href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1-crmsh/html/Clusters_from_Scratch/index.html">Clusters from Scratch</a>), the CRM shell can still be a daunting place to be. Whilst there are GUI cluster resource configuration tools available, I much prefer to use the CRM shell due to the flexibility it offers. It is worth taking some time to learn the shell – you will be rewarded for doing so as you will have full control over your cluster.</p>
<p>First off, as we’re only running a demo cluster and do not have any real fencing methods available to us, let’s disable STONITH:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e055d" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm configure property stonith-enabled=false</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e055d-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e055d-1"><span class="crayon-p"># crm configure property stonith-enabled=false</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>and as this is a two-node cluster, ignore a loss of quorum:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e05b7" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm configure property no-quorum-policy=ignore</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e05b7-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e05b7-1"><span class="crayon-p"># crm configure property no-quorum-policy=ignore</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Let’s create our first resource – the failover IP address. Using the <code><strong>ocf:heartbeat:IPaddr2</strong></code> resource agent:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e060c" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm configure primitive failover_ip ocf:heartbeat:IPaddr2 params ip=192.168.122.33 cidr_netmask=32 op monitor interval=30s</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e060c-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e060c-1"><span class="crayon-p"># crm configure primitive failover_ip ocf:heartbeat:IPaddr2 params ip=192.168.122.33 cidr_netmask=32 op monitor interval=30s</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Here, you can see that the IP address resource (or <code><strong>primitive</strong></code>) of agent type <code><strong>ocf:heartbeat:IPaddr2</strong> </code>has been created with a name of<code><strong> failover_ip</strong></code>. There are parameters passed (an <code><strong>ip</strong></code> of <code><strong>192.168.122.33</strong></code> and a<code><strong> cidr_netmask</strong></code> of<code><strong> 32</strong></code>) and operations (here, a <code><strong>monitor</strong></code> of <code><strong>interval</strong><strong> 20s</strong></code>). If you are ever unsure of which parameters and operations a resource agent supports, you can view extensive documentation via the<code><strong> crm ra meta &lt;ra-name&gt;</strong></code> command:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0676" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm ra meta ocf:heartbeat:IPaddr2</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0676-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0676-1"><span class="crayon-p"># crm ra meta ocf:heartbeat:IPaddr2</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Once the<code><strong> failover_ip</strong></code> resource has been created, you can view the status of it with<code><strong> crm resource status</strong></code>:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e06d5" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm resource status failover_ip
resource failover_ip is running on: rhcs-node01.local</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e06d5-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e06d5-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e06d5-1"><span class="crayon-p"># crm resource status failover_ip</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e06d5-2"><span class="crayon-e">resource </span><span class="crayon-e">failover_ip </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">running </span><span class="crayon-i">on</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Running<code><strong> ip addr</strong> </code>will also show you that the new IP address is online:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e072a" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># ip addr | grep '\.33'
    inet 192.168.122.33/32 brd 192.168.122.33 scope global eth0</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e072a-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e072a-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e072a-1"><span class="crayon-p"># ip addr | grep '\.33'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e072a-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">inet</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.122.33</span><span class="crayon-o">/</span><span class="crayon-cn">32</span><span class="crayon-h"> </span><span class="crayon-i">brd</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.122.33</span><span class="crayon-h"> </span><span class="crayon-e">scope </span><span class="crayon-e">global </span><span class="crayon-i">eth0</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>You can now use <code><strong>crm move resource &lt;resource&gt;</strong></code> to move the resource to the second node:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e077d" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm resource move failover_ip
WARNING: Creating rsc_location constraint 'cli-standby-failover_ip' with a score of -INFINITY for resource failover_ip on rhcs-node01.local.
   This will prevent failover_ip from running on rhcs-node01.local until the constraint is removed using the 'crm_resource -U' command or manually with cibadmin
   This will be the case even if rhcs-node01.local is the last node in the cluster
   This message can be disabled with -Q</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e077d-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e077d-2">2</div><div class="crayon-num" data-line="crayon-5593a443e077d-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e077d-4">4</div><div class="crayon-num" data-line="crayon-5593a443e077d-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e077d-1"><span class="crayon-p"># crm resource move failover_ip</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e077d-2"><span class="crayon-i">WARNING</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Creating </span><span class="crayon-e">rsc_location </span><span class="crayon-i">constraint</span><span class="crayon-h"> </span><span class="crayon-s">'cli-standby-failover_ip'</span><span class="crayon-h"> </span><span class="crayon-i">with</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-e">score </span><span class="crayon-i">of</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-e">INFINITY </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">resource </span><span class="crayon-e">failover_ip </span><span class="crayon-e">on </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5593a443e077d-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">This</span><span class="crayon-h"> </span><span class="crayon-e">will </span><span class="crayon-e">prevent </span><span class="crayon-e">failover_ip </span><span class="crayon-e">from </span><span class="crayon-e">running </span><span class="crayon-e">on </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-st">until</span><span class="crayon-h"> </span><span class="crayon-e">the </span><span class="crayon-e">constraint </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">removed </span><span class="crayon-e">using </span><span class="crayon-i">the</span><span class="crayon-h"> </span><span class="crayon-s">'crm_resource -U'</span><span class="crayon-h"> </span><span class="crayon-r">command</span><span class="crayon-h"> </span><span class="crayon-st">or</span><span class="crayon-h"> </span><span class="crayon-e">manually </span><span class="crayon-e">with </span><span class="crayon-e">cibadmin</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e077d-4"><span class="crayon-e">&nbsp;&nbsp; </span><span class="crayon-r">This</span><span class="crayon-h"> </span><span class="crayon-e">will </span><span class="crayon-e">be </span><span class="crayon-e">the </span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-e">even </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">the </span><span class="crayon-e">last </span><span class="crayon-e">node </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">the </span><span class="crayon-e">cluster</span></div><div class="crayon-line" id="crayon-5593a443e077d-5"><span class="crayon-e">&nbsp;&nbsp; </span><span class="crayon-r">This</span><span class="crayon-h"> </span><span class="crayon-e">message </span><span class="crayon-e">can </span><span class="crayon-e">be </span><span class="crayon-e">disabled </span><span class="crayon-i">with</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">Q</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0039 seconds] -->
<p>Oh noes! What does this mean? Essentially – you, the sysadmin, know what you are doing, and have manually forced a move of a cluster-managed resource. The cluster manager therefore deems the current node unfit for purpose and creates a location constraint with a score of <code><strong>-INFINITY</strong></code> (negative-infinity) – the resource will never run there again. You can remove the constraint via the <code><strong>crm</strong></code> shell, or just fail it back with<code><strong> crm unmove resource &lt;resource&gt;</strong> </code>which will also deem the node fit for purpose once again, and remove the constraint:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e07d3" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm unmove resource failover_ip</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e07d3-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e07d3-1"><span class="crayon-p"># crm unmove resource failover_ip</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>You can also test failover by making the current node <code><strong>standby</strong></code>:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0838" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm node standby</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0838-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0838-1"><span class="crayon-p"># crm node standby</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Remembering to bring it <code><strong>online</strong></code> again once done:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0899" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm node online</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0899-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0899-1"><span class="crayon-p"># crm node online</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>You can view the current status of the cluster and any resources with <code><strong>crm status</strong></code>, or<code><strong> crm_mon -1</strong></code> which will do the same thing – more on that later:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e08f4" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm status
# crm_mon -1</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e08f4-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e08f4-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e08f4-1"><span class="crayon-p"># crm status</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e08f4-2"><span class="crayon-p"># crm_mon -1</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>You now have the first clustered resource working, and failing over as needed – the “floating” IP address. Next, nginx.</p>
<h1>nginx Installation and Configuration</h1>
<p>At this point, I’ll install nginx as it’ll be the next clustered resource to be configured:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0951" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># yum install -y http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm
# yum install -y nginx</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0951-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0951-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0951-1"><span class="crayon-p"># yum install -y http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0951-2"><span class="crayon-p"># yum install -y nginx</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Again, ensure that it doesn’t start automatically on boot, as the cluster will manage the nginx service:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e09aa" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># chkconfig nginx off</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e09aa-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e09aa-1"><span class="crayon-p"># chkconfig nginx off</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Reading the output of <code><strong>crm ra meta nginx</strong></code>, we learn that the agent works by polling<code><strong> /nginx_status</strong></code>. This is not present in the configuration provided by the nginx RPMs just installed, so we will need to add it manually. I configured it as per the <a href="http://wiki.nginx.org/HttpStubStatusModule">HttpStubStatusModule</a> documentation, with appropriate ACLs:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0a07" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># vi /etc/nginx/conf.d/default.conf
...
    location /nginx_status {
        stub_status on;
        access_log off;
        allow 127.0.0.1;
        allow 192.168.122.0/24;
        deny all;
...</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0a07-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0a07-2">2</div><div class="crayon-num" data-line="crayon-5593a443e0a07-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0a07-4">4</div><div class="crayon-num" data-line="crayon-5593a443e0a07-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0a07-6">6</div><div class="crayon-num" data-line="crayon-5593a443e0a07-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0a07-8">8</div><div class="crayon-num" data-line="crayon-5593a443e0a07-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0a07-1"><span class="crayon-p"># vi /etc/nginx/conf.d/default.conf</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0a07-2"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5593a443e0a07-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">location</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-e">nginx_status</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0a07-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">stub_status </span><span class="crayon-i">on</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e0a07-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">access_log </span><span class="crayon-i">off</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0a07-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">allow</span><span class="crayon-h"> </span><span class="crayon-cn">127.0.0.1</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e0a07-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">allow</span><span class="crayon-h"> </span><span class="crayon-cn">192.168.122.0</span><span class="crayon-o">/</span><span class="crayon-cn">24</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0a07-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">deny </span><span class="crayon-i">all</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e0a07-9"><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0018 seconds] -->
<p>Once done, start nginx and test that this URL is reachable:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0a66" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># service nginx start
# curl http://localhost/nginx_status
# service nginx stop</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0a66-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0a66-2">2</div><div class="crayon-num" data-line="crayon-5593a443e0a66-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0a66-1"><span class="crayon-p"># service nginx start</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0a66-2"><span class="crayon-p"># curl http://localhost/nginx_status</span></div><div class="crayon-line" id="crayon-5593a443e0a66-3"><span class="crayon-p"># service nginx stop</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Next, configure the nginx resource via the <code><strong>crm</strong></code> shell:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0abc" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm configure primitive nginx_res ocf:heartbeat:nginx params configfile=/etc/nginx/nginx.conf httpd=/usr/sbin/nginx op monitor interval=60s timeout=10s op start timeout=40s op stop timeout=60s
WARNING: nginx_res: specified timeout 10s for monitor is smaller than the advised 30s
# crm configure colocation nginx_ip_colo INFINITY: nginx_res failover_ip
# crm configure order nginx_after_ip mandatory: failover_ip nginx_res</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0abc-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0abc-2">2</div><div class="crayon-num" data-line="crayon-5593a443e0abc-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0abc-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0abc-1"><span class="crayon-p"># crm configure primitive nginx_res ocf:heartbeat:nginx params configfile=/etc/nginx/nginx.conf httpd=/usr/sbin/nginx op monitor interval=60s timeout=10s op start timeout=40s op stop timeout=60s</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0abc-2"><span class="crayon-i">WARNING</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">nginx_res</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">specified </span><span class="crayon-i">timeout</span><span class="crayon-h"> </span><span class="crayon-cn">10s</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">monitor </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">smaller </span><span class="crayon-e">than </span><span class="crayon-e">the </span><span class="crayon-i">advised</span><span class="crayon-h"> </span><span class="crayon-cn">30s</span></div><div class="crayon-line" id="crayon-5593a443e0abc-3"><span class="crayon-p"># crm configure colocation nginx_ip_colo INFINITY: nginx_res failover_ip</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0abc-4"><span class="crayon-p"># crm configure order nginx_after_ip mandatory: failover_ip nginx_res</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
<p>The WARNING I’ll ignore – a <code><strong>10s</strong></code> timeout for a response from<code><strong> /nginx_status</strong></code> is still quite conservative. Quite a bit happened above. First, I configured another <code><strong>primitive</strong></code> (i.e. resource) called<code><strong> nginx_res</strong></code>, using the <code><strong>ocf:heartbeat:nginx</strong></code> resource agent. I specified a path to the <code><strong>configfile</strong></code> and the nginx binary (<code><strong>httpd=</strong></code>) and then specified various operations to define <code><strong>monitor</strong></code>, <code><strong>start</strong></code> and <code><strong>stop</strong></code> timeouts.</p>
<p>Next, I created a <code><strong>colocation</strong></code> called <code><strong>nginx_ip_colo</strong></code>. Colocations tell the cluster that resources need to be colocated on the same node. An affinity of <code><strong>INFINITY</strong></code> is specified – i.e. <code><strong>nginx_res</strong></code> and <code><strong>failover_ip</strong></code> MUST be on the same node, no exceptions.<code><strong> -INFINITY</strong></code> (i.e. negative infinity) would have the two resources repel and run on different nodes, no exceptions – not what we want.</p>
<p>Finally a <code><strong>mandatory</strong></code> (does the same thing as <code><strong>INFINITY</strong></code>) order directive, <code><strong>nginx_after_ip</strong></code>, was created, forcing <code><strong>nginx_res</strong></code> to start after<code><strong> failover_ip</strong></code>.</p>
<p><code><strong>crm configure show</strong> </code>now shows the current status of our cluster configuration:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0b12" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm configure show
node rhcs-node01.local \
    attributes standby="off"
node rhcs-node02.local \
    attributes standby="off"
primitive failover_ip ocf:heartbeat:IPaddr2 \
    params ip="192.168.122.33" cidr_netmask="32" \
    op monitor interval="30s"
primitive nginx_res ocf:heartbeat:nginx \
    params configfile="/etc/nginx/nginx.conf" httpd="/usr/sbin/nginx" \
    op monitor interval="60s" timeout="10s" \
    op start interval="0" timeout="40s" \
    op stop interval="0" timeout="60s"
colocation nginx_ip_colo inf: nginx_res failover_ip
order nginx_after_ip inf: failover_ip nginx_res
property $id="cib-bootstrap-options" \
    dc-version="1.1.8-7.el6-394e906" \
    cluster-infrastructure="classic openais (with plugin)" \
    expected-quorum-votes="2" \
    stonith-enabled="false" \
    no-quorum-policy="ignore"</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -25px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0b12-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b12-2">2</div><div class="crayon-num" data-line="crayon-5593a443e0b12-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b12-4">4</div><div class="crayon-num" data-line="crayon-5593a443e0b12-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b12-6">6</div><div class="crayon-num" data-line="crayon-5593a443e0b12-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b12-8">8</div><div class="crayon-num" data-line="crayon-5593a443e0b12-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b12-10">10</div><div class="crayon-num" data-line="crayon-5593a443e0b12-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b12-12">12</div><div class="crayon-num" data-line="crayon-5593a443e0b12-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b12-14">14</div><div class="crayon-num" data-line="crayon-5593a443e0b12-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b12-16">16</div><div class="crayon-num" data-line="crayon-5593a443e0b12-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b12-18">18</div><div class="crayon-num" data-line="crayon-5593a443e0b12-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b12-20">20</div><div class="crayon-num" data-line="crayon-5593a443e0b12-21">21</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0b12-1"><span class="crayon-p"># crm configure show</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b12-2"><span class="crayon-e">node </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0b12-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">attributes </span><span class="crayon-v">standby</span><span class="crayon-o">=</span><span class="crayon-s">"off"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b12-4"><span class="crayon-e">node </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0b12-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">attributes </span><span class="crayon-v">standby</span><span class="crayon-o">=</span><span class="crayon-s">"off"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b12-6"><span class="crayon-e">primitive </span><span class="crayon-e">failover_ip </span><span class="crayon-i">ocf</span><span class="crayon-o">:</span><span class="crayon-i">heartbeat</span><span class="crayon-o">:</span><span class="crayon-i">IPaddr2</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0b12-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">params </span><span class="crayon-v">ip</span><span class="crayon-o">=</span><span class="crayon-s">"192.168.122.33"</span><span class="crayon-h"> </span><span class="crayon-v">cidr_netmask</span><span class="crayon-o">=</span><span class="crayon-s">"32"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b12-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">op </span><span class="crayon-e">monitor </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-s">"30s"</span></div><div class="crayon-line" id="crayon-5593a443e0b12-9"><span class="crayon-e">primitive </span><span class="crayon-e">nginx_res </span><span class="crayon-i">ocf</span><span class="crayon-o">:</span><span class="crayon-i">heartbeat</span><span class="crayon-o">:</span><span class="crayon-i">nginx</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b12-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">params </span><span class="crayon-v">configfile</span><span class="crayon-o">=</span><span class="crayon-s">"/etc/nginx/nginx.conf"</span><span class="crayon-h"> </span><span class="crayon-v">httpd</span><span class="crayon-o">=</span><span class="crayon-s">"/usr/sbin/nginx"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0b12-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">op </span><span class="crayon-e">monitor </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-s">"60s"</span><span class="crayon-h"> </span><span class="crayon-v">timeout</span><span class="crayon-o">=</span><span class="crayon-s">"10s"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b12-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">op </span><span class="crayon-e">start </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">timeout</span><span class="crayon-o">=</span><span class="crayon-s">"40s"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0b12-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">op </span><span class="crayon-e">stop </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">timeout</span><span class="crayon-o">=</span><span class="crayon-s">"60s"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b12-14"><span class="crayon-e">colocation </span><span class="crayon-e">nginx_ip_colo </span><span class="crayon-i">inf</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">nginx_res </span><span class="crayon-e">failover_ip</span></div><div class="crayon-line" id="crayon-5593a443e0b12-15"><span class="crayon-e">order </span><span class="crayon-e">nginx_after_ip </span><span class="crayon-i">inf</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">failover_ip </span><span class="crayon-e">nginx_res</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b12-16"><span class="crayon-i">property</span><span class="crayon-h"> </span><span class="crayon-v">$id</span><span class="crayon-o">=</span><span class="crayon-s">"cib-bootstrap-options"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0b12-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">dc</span><span class="crayon-o">-</span><span class="crayon-v">version</span><span class="crayon-o">=</span><span class="crayon-s">"1.1.8-7.el6-394e906"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b12-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">cluster</span><span class="crayon-o">-</span><span class="crayon-v">infrastructure</span><span class="crayon-o">=</span><span class="crayon-s">"classic openais (with plugin)"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0b12-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">expected</span><span class="crayon-o">-</span><span class="crayon-i">quorum</span><span class="crayon-o">-</span><span class="crayon-v">votes</span><span class="crayon-o">=</span><span class="crayon-s">"2"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b12-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">stonith</span><span class="crayon-o">-</span><span class="crayon-v">enabled</span><span class="crayon-o">=</span><span class="crayon-s">"false"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0b12-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">no</span><span class="crayon-o">-</span><span class="crayon-i">quorum</span><span class="crayon-o">-</span><span class="crayon-v">policy</span><span class="crayon-o">=</span><span class="crayon-s">"ignore"</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0059 seconds] -->
<p>A “one-shot” view of our cluster status with <code><strong>crm_mon -1</strong></code> shows the cluster operating as expected, with the <code><strong>failover_ip</strong></code> and <code><strong>nginx_res</strong> </code>resources being served from the same node (<strong>rhcs-node02.local</strong>):</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0b69" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm_mon -1
Last updated: Thu Jun 13 14:58:55 2013
Last change: Thu Jun 13 14:57:09 2013 via cibadmin on rhcs-node01.local
Stack: classic openais (with plugin)
Current DC: rhcs-node01.local - partition with quorum
Version: 1.1.8-7.el6-394e906
2 Nodes configured, 2 expected votes
2 Resources configured.

Online: [ rhcs-node01.local rhcs-node02.local ]

 failover_ip    (ocf::heartbeat:IPaddr2):   Started rhcs-node02.local
 nginx_res  (ocf::heartbeat:nginx): Started rhcs-node02.local</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -25px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0b69-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b69-2">2</div><div class="crayon-num" data-line="crayon-5593a443e0b69-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b69-4">4</div><div class="crayon-num" data-line="crayon-5593a443e0b69-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b69-6">6</div><div class="crayon-num" data-line="crayon-5593a443e0b69-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b69-8">8</div><div class="crayon-num" data-line="crayon-5593a443e0b69-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b69-10">10</div><div class="crayon-num" data-line="crayon-5593a443e0b69-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0b69-12">12</div><div class="crayon-num" data-line="crayon-5593a443e0b69-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0b69-1"><span class="crayon-p"># crm_mon -1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b69-2"><span class="crayon-e">Last </span><span class="crayon-i">updated</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Thu </span><span class="crayon-i">Jun</span><span class="crayon-h"> </span><span class="crayon-cn">13</span><span class="crayon-h"> </span><span class="crayon-cn">14</span><span class="crayon-o">:</span><span class="crayon-cn">58</span><span class="crayon-o">:</span><span class="crayon-cn">55</span><span class="crayon-h"> </span><span class="crayon-cn">2013</span></div><div class="crayon-line" id="crayon-5593a443e0b69-3"><span class="crayon-e">Last </span><span class="crayon-i">change</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Thu </span><span class="crayon-i">Jun</span><span class="crayon-h"> </span><span class="crayon-cn">13</span><span class="crayon-h"> </span><span class="crayon-cn">14</span><span class="crayon-o">:</span><span class="crayon-cn">57</span><span class="crayon-o">:</span><span class="crayon-cn">09</span><span class="crayon-h"> </span><span class="crayon-cn">2013</span><span class="crayon-h"> </span><span class="crayon-e">via </span><span class="crayon-e">cibadmin </span><span class="crayon-e">on </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b69-4"><span class="crayon-i">Stack</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">classic </span><span class="crayon-e">openais</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">with </span><span class="crayon-i">plugin</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5593a443e0b69-5"><span class="crayon-e">Current </span><span class="crayon-i">DC</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">partition </span><span class="crayon-e">with </span><span class="crayon-e">quorum</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b69-6"><span class="crayon-i">Version</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1.1.8</span><span class="crayon-o">-</span><span class="crayon-cn">7.el6</span><span class="crayon-o">-</span><span class="crayon-cn">394e906</span></div><div class="crayon-line" id="crayon-5593a443e0b69-7"><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-e">Nodes </span><span class="crayon-i">configured</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-e">expected </span><span class="crayon-i">votes</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b69-8"><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-e">Resources </span><span class="crayon-v">configured</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5593a443e0b69-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b69-10"><span class="crayon-i">Online</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5593a443e0b69-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0b69-12"><span class="crayon-h"> </span><span class="crayon-e">failover_ip</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span><span class="crayon-i">ocf</span><span class="crayon-o">::</span><span class="crayon-i">heartbeat</span><span class="crayon-o">:</span><span class="crayon-i">IPaddr2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-e">Started </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span></div><div class="crayon-line" id="crayon-5593a443e0b69-13"><span class="crayon-h"> </span><span class="crayon-e">nginx_res</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-sy">(</span><span class="crayon-i">ocf</span><span class="crayon-o">::</span><span class="crayon-i">heartbeat</span><span class="crayon-o">:</span><span class="crayon-i">nginx</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Started </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0049 seconds] -->
<p>We can again move the resources around with <code><strong>crm move/unmove resource</strong></code>:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0bbf" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm resource move nginx_res 
WARNING: Creating rsc_location constraint 'cli-standby-nginx_res' with a score of -INFINITY for resource nginx_res on rhcs-node02.local.
    This will prevent nginx_res from running on rhcs-node02.local until the constraint is removed using the 'crm_resource -U' command or manually with cibadmin
    This will be the case even if rhcs-node02.local is the last node in the cluster
    This message can be disabled with -Q
# crm resource unmove nginx_res</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0bbf-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0bbf-2">2</div><div class="crayon-num" data-line="crayon-5593a443e0bbf-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0bbf-4">4</div><div class="crayon-num" data-line="crayon-5593a443e0bbf-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0bbf-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0bbf-1"><span class="crayon-p"># crm resource move nginx_res </span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0bbf-2"><span class="crayon-i">WARNING</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Creating </span><span class="crayon-e">rsc_location </span><span class="crayon-i">constraint</span><span class="crayon-h"> </span><span class="crayon-s">'cli-standby-nginx_res'</span><span class="crayon-h"> </span><span class="crayon-i">with</span><span class="crayon-h"> </span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-e">score </span><span class="crayon-i">of</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-e">INFINITY </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">resource </span><span class="crayon-e">nginx_res </span><span class="crayon-e">on </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5593a443e0bbf-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">This</span><span class="crayon-h"> </span><span class="crayon-e">will </span><span class="crayon-e">prevent </span><span class="crayon-e">nginx_res </span><span class="crayon-e">from </span><span class="crayon-e">running </span><span class="crayon-e">on </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-st">until</span><span class="crayon-h"> </span><span class="crayon-e">the </span><span class="crayon-e">constraint </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">removed </span><span class="crayon-e">using </span><span class="crayon-i">the</span><span class="crayon-h"> </span><span class="crayon-s">'crm_resource -U'</span><span class="crayon-h"> </span><span class="crayon-r">command</span><span class="crayon-h"> </span><span class="crayon-st">or</span><span class="crayon-h"> </span><span class="crayon-e">manually </span><span class="crayon-e">with </span><span class="crayon-e">cibadmin</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0bbf-4"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">This</span><span class="crayon-h"> </span><span class="crayon-e">will </span><span class="crayon-e">be </span><span class="crayon-e">the </span><span class="crayon-st">case</span><span class="crayon-h"> </span><span class="crayon-e">even </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-e">the </span><span class="crayon-e">last </span><span class="crayon-e">node </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">the </span><span class="crayon-e">cluster</span></div><div class="crayon-line" id="crayon-5593a443e0bbf-5"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">This</span><span class="crayon-h"> </span><span class="crayon-e">message </span><span class="crayon-e">can </span><span class="crayon-e">be </span><span class="crayon-e">disabled </span><span class="crayon-i">with</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">Q</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0bbf-6"><span class="crayon-p"># crm resource unmove nginx_res</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0035 seconds] -->
<p>Next, DRBD integration into the cluster.</p>
<h1>DRBD Cluster Configuration</h1>
<p>All this time, we’ve been issuing commands and making direct changes to the cluster configuration, e.g.<code><strong> crm configure &lt;some-configuration&gt;</strong> </code>- the changes are applied immediately. However, if we try to configure the multi-part DRBD resources like this, some of the configuration will be applied before the entire resource has been configured, which will not give us the desired result. Therefore, I’ll take a copy of the current CIB configuration and make changes there on a “shadow instance”, verify, then commit back into the main cluster configuration. This is a much safer way of working, and should be used when making <em>any significant</em> change on a Production cluster.</p>
<p>Let’s start by creating the shadow configuration instance:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0c15" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm
crm(live)# cib new drbd
INFO: drbd shadow CIB created
crm(drbd)#</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0c15-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0c15-2">2</div><div class="crayon-num" data-line="crayon-5593a443e0c15-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0c15-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0c15-1"><span class="crayon-p"># crm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0c15-2"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">live</span><span class="crayon-sy">)</span><span class="crayon-p"># cib new drbd</span></div><div class="crayon-line" id="crayon-5593a443e0c15-3"><span class="crayon-i">INFO</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">drbd </span><span class="crayon-e">shadow </span><span class="crayon-e">CIB </span><span class="crayon-e">created</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0c15-4"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">drbd</span><span class="crayon-sy">)</span><span class="crayon-p">#</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>You can see that the <code><strong>crm</strong></code> prompt has changed from<code><strong> crm(live)</strong></code> to <code><strong>crm(drbd)</strong> </code>indicating that we are working with the shadow instance.</p>
<p>Next, I’ll create the DRBD primitive and a new type of resource – <code><strong>ms</strong></code>:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0c73" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;">crm(drbd)# configure primitive drbd_res ocf:linbit:drbd params drbd_resource=data op monitor interval=29s role=Master op monitor interval=31s role=Slave
crm(drbd)# configure ms drbd_master_slave drbd_res meta master-max=1 master-node-max=1 clone-max=2 clone-node-max=1 notify=true</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0c73-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0c73-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0c73-1"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">drbd</span><span class="crayon-sy">)</span><span class="crayon-p"># configure primitive drbd_res ocf:linbit:drbd params drbd_resource=data op monitor interval=29s role=Master op monitor interval=31s role=Slave</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0c73-2"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">drbd</span><span class="crayon-sy">)</span><span class="crayon-p"># configure ms drbd_master_slave drbd_res meta master-max=1 master-node-max=1 clone-max=2 clone-node-max=1 notify=true</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
<p>Again, much has happened. The <code><strong>drbd_res primitive</strong></code> has been created of type <code><strong>ocf:linbit:drbd</strong></code>, with the <code><strong>drbd_resource</strong></code> parameter set to <code><strong>data</strong></code> – the same resource name we defined for our DRBD replicated resource in <code><strong>/etc/drbd.conf</strong></code>. Then, the monitor intervals for both master and slave are defined. Next, the <code><strong>drbd_master_slave ms </strong></code>resource is created – <code><strong>ms</strong></code> resources are used where master/slave relationships are required. Meta data is passed during the creation of this resource ensuring that we only ever have a single master online at any one time. These parameters are taken from the <a href="http://www.drbd.org/users-guide/s-pacemaker-crm-drbd-backed-service.html">DRBD on Pacemaker</a> documentation.</p>
<p>Run a<code><strong> configure show</strong></code> and verify that all is well – if you’re happy, <code><strong>commit</strong></code> your changes to the live cluster configuration:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0cce" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;">crm(drbd)# crm configure
crm(drbd)# cib commit drbd
crm(live)# quit</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0cce-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0cce-2">2</div><div class="crayon-num" data-line="crayon-5593a443e0cce-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0cce-1"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">drbd</span><span class="crayon-sy">)</span><span class="crayon-p"># crm configure</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0cce-2"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">drbd</span><span class="crayon-sy">)</span><span class="crayon-p"># cib commit drbd</span></div><div class="crayon-line" id="crayon-5593a443e0cce-3"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">live</span><span class="crayon-sy">)</span><span class="crayon-p"># quit</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p>Next, another shadow instance will be created to configure the filesystem resource that runs atop our DRBD resource:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0d2e" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm
crm(live)# cib new fs</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0d2e-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0d2e-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0d2e-1"><span class="crayon-p"># crm</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0d2e-2"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">live</span><span class="crayon-sy">)</span><span class="crayon-p"># cib new fs</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Create the filesystem resource and appropriate colocation and ordering definitions:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0d82" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;">crm(fs)# configure primitive fs_res ocf:heartbeat:Filesystem params device=/dev/drbd0 directory=/data fstype=ext4
crm(fs)# configure colocation fs_drbd_colo INFINITY: fs_res drbd_master_slave:Master
crm(fs)# configure order fs_after_drbd mandatory: drbd_master_slave:promote fs_res:start
crm(fs)# configure colocation nginx_fs_colo inf: nginx_res fs_res
crm(fs)# configure order nginx_after_fs inf: fs_res nginx_res
crm(fs)# configure show
crm(fs)# cib commit fs</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0d82-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0d82-2">2</div><div class="crayon-num" data-line="crayon-5593a443e0d82-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0d82-4">4</div><div class="crayon-num" data-line="crayon-5593a443e0d82-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0d82-6">6</div><div class="crayon-num" data-line="crayon-5593a443e0d82-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0d82-1"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">fs</span><span class="crayon-sy">)</span><span class="crayon-p"># configure primitive fs_res ocf:heartbeat:Filesystem params device=/dev/drbd0 directory=/data fstype=ext4</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0d82-2"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">fs</span><span class="crayon-sy">)</span><span class="crayon-p"># configure colocation fs_drbd_colo INFINITY: fs_res drbd_master_slave:Master</span></div><div class="crayon-line" id="crayon-5593a443e0d82-3"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">fs</span><span class="crayon-sy">)</span><span class="crayon-p"># configure order fs_after_drbd mandatory: drbd_master_slave:promote fs_res:start</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0d82-4"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">fs</span><span class="crayon-sy">)</span><span class="crayon-p"># configure colocation nginx_fs_colo inf: nginx_res fs_res</span></div><div class="crayon-line" id="crayon-5593a443e0d82-5"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">fs</span><span class="crayon-sy">)</span><span class="crayon-p"># configure order nginx_after_fs inf: fs_res nginx_res</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0d82-6"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">fs</span><span class="crayon-sy">)</span><span class="crayon-p"># configure show</span></div><div class="crayon-line" id="crayon-5593a443e0d82-7"><span class="crayon-e">crm</span><span class="crayon-sy">(</span><span class="crayon-i">fs</span><span class="crayon-sy">)</span><span class="crayon-p"># cib commit fs</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0016 seconds] -->
<p>So – another primitive,<code><strong> fs_res</strong></code>, of type <code><strong>ocf:heartbeat:Filesystem</strong></code> is created on device<code><strong> /dev/drbd0</strong></code>, to be mounted on <code><strong>directory</strong><strong> /data</strong></code>, of <code><strong>fstype</strong></code> <code><strong>ext4</strong></code>.</p>
<p>Colocations are then created so that the<code><strong> fs_res</strong></code> is colocated on whichever node is running <code><strong>drbd_master_slave:Master</strong></code>, and that<code><strong> nginx_res</strong></code> runs wherever <code><strong>fs_res</strong></code> is running. Ordering is configured so that <code><strong>drbd_master_slave:promote</strong></code> occurs before <code><strong>fs_res:start</strong> </code>(i.e. the DRBD resource is promoted to master before the filesystem resource is started and any mount occurs), and that <code><strong>nginx_res</strong></code> is only started after<code><strong> fs_res</strong></code> is online. The configuration is then checked, and committed.&nbsp; I’ve substituted “<code><strong>INFINITY:</strong></code>“, “<code><strong>inf:</strong></code>” and “<code><strong>mandatory:</strong></code>” above to show that they all do exactly the same thing, and as you’ll see below, all get converted to “<code><strong>inf:</strong></code>” in the committed configuration.</p>
<p>If this were a production cluster, I’d just need to configure STONITH here as an additional step. However, for our purposes, the cluster configuration is now complete – and we have a replicated storage volume that is promoted/demoted appropriately across the master/slave, and a failover nginx instance. One final step is to have nginx serve files from the shared storage.</p>
<h1>Final Steps</h1>
<p>Let’s take a look at the completed cluster configuration:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0dd7" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm configure show
node rhcs-node01.local \
    attributes standby="off"
node rhcs-node02.local \
    attributes standby="off"
primitive drbd_res ocf:linbit:drbd \
    params drbd_resource="data" \
    op monitor interval="29s" role="Master" \
    op monitor interval="31s" role="Slave"
primitive failover_ip ocf:heartbeat:IPaddr2 \
    params ip="192.168.122.33" cidr_netmask="32" \
    op monitor interval="30s"
primitive fs_res ocf:heartbeat:Filesystem \
    params device="/dev/drbd0" directory="/data" fstype="ext4"
primitive nginx_res ocf:heartbeat:nginx \
    params configfile="/etc/nginx/nginx.conf" httpd="/usr/sbin/nginx" \
    op monitor interval="60s" timeout="10s" \
    op start interval="0" timeout="40s" \
    op stop interval="0" timeout="60s"
ms drbd_master_slave drbd_res \
    meta master-max="1" master-node-max="1" clone-max="2" clone-node-max="1" notify="true"
colocation fs_drbd_colo inf: fs_res drbd_master_slave:Master
colocation nginx_fs_colo inf: nginx_res fs_res
colocation nginx_ip_colo inf: nginx_res failover_ip
order fs_after_drbd inf: drbd_master_slave:promote fs_res:start
order nginx_after_fs inf: fs_res nginx_res
order nginx_after_ip inf: failover_ip nginx_res
property $id="cib-bootstrap-options" \
    dc-version="1.1.8-7.el6-394e906" \
    cluster-infrastructure="classic openais (with plugin)" \
    expected-quorum-votes="2" \
    stonith-enabled="false" \
    no-quorum-policy="ignore"</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -25px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0dd7-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-2">2</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-4">4</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-6">6</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-8">8</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-10">10</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-12">12</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-14">14</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-16">16</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-18">18</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-20">20</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-22">22</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-24">24</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-26">26</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-28">28</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-30">30</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0dd7-32">32</div><div class="crayon-num" data-line="crayon-5593a443e0dd7-33">33</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0dd7-1"><span class="crayon-p"># crm configure show</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-2"><span class="crayon-e">node </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">attributes </span><span class="crayon-v">standby</span><span class="crayon-o">=</span><span class="crayon-s">"off"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-4"><span class="crayon-e">node </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">attributes </span><span class="crayon-v">standby</span><span class="crayon-o">=</span><span class="crayon-s">"off"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-6"><span class="crayon-e">primitive </span><span class="crayon-e">drbd_res </span><span class="crayon-i">ocf</span><span class="crayon-o">:</span><span class="crayon-i">linbit</span><span class="crayon-o">:</span><span class="crayon-i">drbd</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">params </span><span class="crayon-v">drbd_resource</span><span class="crayon-o">=</span><span class="crayon-s">"data"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">op </span><span class="crayon-e">monitor </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-s">"29s"</span><span class="crayon-h"> </span><span class="crayon-v">role</span><span class="crayon-o">=</span><span class="crayon-s">"Master"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">op </span><span class="crayon-e">monitor </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-s">"31s"</span><span class="crayon-h"> </span><span class="crayon-v">role</span><span class="crayon-o">=</span><span class="crayon-s">"Slave"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-10"><span class="crayon-e">primitive </span><span class="crayon-e">failover_ip </span><span class="crayon-i">ocf</span><span class="crayon-o">:</span><span class="crayon-i">heartbeat</span><span class="crayon-o">:</span><span class="crayon-i">IPaddr2</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">params </span><span class="crayon-v">ip</span><span class="crayon-o">=</span><span class="crayon-s">"192.168.122.33"</span><span class="crayon-h"> </span><span class="crayon-v">cidr_netmask</span><span class="crayon-o">=</span><span class="crayon-s">"32"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">op </span><span class="crayon-e">monitor </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-s">"30s"</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-13"><span class="crayon-e">primitive </span><span class="crayon-e">fs_res </span><span class="crayon-i">ocf</span><span class="crayon-o">:</span><span class="crayon-i">heartbeat</span><span class="crayon-o">:</span><span class="crayon-i">Filesystem</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">params </span><span class="crayon-v">device</span><span class="crayon-o">=</span><span class="crayon-s">"/dev/drbd0"</span><span class="crayon-h"> </span><span class="crayon-v">directory</span><span class="crayon-o">=</span><span class="crayon-s">"/data"</span><span class="crayon-h"> </span><span class="crayon-v">fstype</span><span class="crayon-o">=</span><span class="crayon-s">"ext4"</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-15"><span class="crayon-e">primitive </span><span class="crayon-e">nginx_res </span><span class="crayon-i">ocf</span><span class="crayon-o">:</span><span class="crayon-i">heartbeat</span><span class="crayon-o">:</span><span class="crayon-i">nginx</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">params </span><span class="crayon-v">configfile</span><span class="crayon-o">=</span><span class="crayon-s">"/etc/nginx/nginx.conf"</span><span class="crayon-h"> </span><span class="crayon-v">httpd</span><span class="crayon-o">=</span><span class="crayon-s">"/usr/sbin/nginx"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">op </span><span class="crayon-e">monitor </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-s">"60s"</span><span class="crayon-h"> </span><span class="crayon-v">timeout</span><span class="crayon-o">=</span><span class="crayon-s">"10s"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">op </span><span class="crayon-e">start </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">timeout</span><span class="crayon-o">=</span><span class="crayon-s">"40s"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">op </span><span class="crayon-e">stop </span><span class="crayon-v">interval</span><span class="crayon-o">=</span><span class="crayon-s">"0"</span><span class="crayon-h"> </span><span class="crayon-v">timeout</span><span class="crayon-o">=</span><span class="crayon-s">"60s"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-20"><span class="crayon-e">ms </span><span class="crayon-e">drbd_master_slave </span><span class="crayon-i">drbd_res</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">meta </span><span class="crayon-i">master</span><span class="crayon-o">-</span><span class="crayon-v">max</span><span class="crayon-o">=</span><span class="crayon-s">"1"</span><span class="crayon-h"> </span><span class="crayon-i">master</span><span class="crayon-o">-</span><span class="crayon-i">node</span><span class="crayon-o">-</span><span class="crayon-v">max</span><span class="crayon-o">=</span><span class="crayon-s">"1"</span><span class="crayon-h"> </span><span class="crayon-r">clone</span><span class="crayon-o">-</span><span class="crayon-v">max</span><span class="crayon-o">=</span><span class="crayon-s">"2"</span><span class="crayon-h"> </span><span class="crayon-r">clone</span><span class="crayon-o">-</span><span class="crayon-i">node</span><span class="crayon-o">-</span><span class="crayon-v">max</span><span class="crayon-o">=</span><span class="crayon-s">"1"</span><span class="crayon-h"> </span><span class="crayon-v">notify</span><span class="crayon-o">=</span><span class="crayon-s">"true"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-22"><span class="crayon-e">colocation </span><span class="crayon-e">fs_drbd_colo </span><span class="crayon-i">inf</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">fs_res </span><span class="crayon-i">drbd_master_slave</span><span class="crayon-o">:</span><span class="crayon-e">Master</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-23"><span class="crayon-e">colocation </span><span class="crayon-e">nginx_fs_colo </span><span class="crayon-i">inf</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">nginx_res </span><span class="crayon-e">fs_res</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-24"><span class="crayon-e">colocation </span><span class="crayon-e">nginx_ip_colo </span><span class="crayon-i">inf</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">nginx_res </span><span class="crayon-e">failover_ip</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-25"><span class="crayon-e">order </span><span class="crayon-e">fs_after_drbd </span><span class="crayon-i">inf</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">drbd_master_slave</span><span class="crayon-o">:</span><span class="crayon-e">promote </span><span class="crayon-i">fs_res</span><span class="crayon-o">:</span><span class="crayon-e">start</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-26"><span class="crayon-e">order </span><span class="crayon-e">nginx_after_fs </span><span class="crayon-i">inf</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">fs_res </span><span class="crayon-e">nginx_res</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-27"><span class="crayon-e">order </span><span class="crayon-e">nginx_after_ip </span><span class="crayon-i">inf</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">failover_ip </span><span class="crayon-e">nginx_res</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-28"><span class="crayon-i">property</span><span class="crayon-h"> </span><span class="crayon-v">$id</span><span class="crayon-o">=</span><span class="crayon-s">"cib-bootstrap-options"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">dc</span><span class="crayon-o">-</span><span class="crayon-v">version</span><span class="crayon-o">=</span><span class="crayon-s">"1.1.8-7.el6-394e906"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">cluster</span><span class="crayon-o">-</span><span class="crayon-v">infrastructure</span><span class="crayon-o">=</span><span class="crayon-s">"classic openais (with plugin)"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">expected</span><span class="crayon-o">-</span><span class="crayon-i">quorum</span><span class="crayon-o">-</span><span class="crayon-v">votes</span><span class="crayon-o">=</span><span class="crayon-s">"2"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0dd7-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">stonith</span><span class="crayon-o">-</span><span class="crayon-v">enabled</span><span class="crayon-o">=</span><span class="crayon-s">"false"</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="crayon-5593a443e0dd7-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">no</span><span class="crayon-o">-</span><span class="crayon-i">quorum</span><span class="crayon-o">-</span><span class="crayon-v">policy</span><span class="crayon-o">=</span><span class="crayon-s">"ignore"</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0100 seconds] -->
<p>As you can see, it’s not really that daunting at all once you’ve worked through the confirguation steps.</p>
<p>Let’s move the nginx document root onto the replicated storage – make the following configuration change on both nodes:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0e2f" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># vi /etc/nginx/conf.d/default.conf

    location / {
        root   /data/htdocs;
        index  index.html index.htm;
    }</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0e2f-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0e2f-2">2</div><div class="crayon-num" data-line="crayon-5593a443e0e2f-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0e2f-4">4</div><div class="crayon-num" data-line="crayon-5593a443e0e2f-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0e2f-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0e2f-1"><span class="crayon-p"># vi /etc/nginx/conf.d/default.conf</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0e2f-2">&nbsp;</div><div class="crayon-line" id="crayon-5593a443e0e2f-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">location</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0e2f-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">root</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-o">/</span><span class="crayon-i">data</span><span class="crayon-o">/</span><span class="crayon-i">htdocs</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5593a443e0e2f-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">index&nbsp;&nbsp;</span><span class="crayon-v">index</span><span class="crayon-e">.html</span><span class="crayon-h"> </span><span class="crayon-v">index</span><span class="crayon-e">.htm</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0e2f-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
<p>and populate index.html from the master node:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0e9a" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># echo "On shared storage..." &gt; /data/htdocs/index.html</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -18px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0e9a-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0e9a-1"><span class="crayon-p"># echo "On shared storage..." &gt; /data/htdocs/index.html</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Fail the services over to the other node, and ensure that the new content is visible. The best way to do this at this point is by taking the current master node offline, then bringing online again (including an appropriate sleep so that the failure is detected). If you leave the node offline, the DRBD slave will not run. As no preference configuration has taken place, the services will not automatically fail back when the node is brought back online. Or, of course, just reboot the master node and ensure failover occurs as expected:</p><!-- Crayon Syntax Highlighter v2.2.1 -->

		<div id="crayon-5593a443e0ef3" class="crayon-syntax crayon-theme-test-theme crayon-font-monaco crayon-os-pc print-yes" data-settings=" minimize scroll-always" style="margin-top: 12px; margin-bottom: 12px; float: none; clear: both; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"><textarea wrap="off" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="tab-size: 4; font-size: 12px !important; line-height: 15px !important; z-index: 0; opacity: 0;"># crm_mon -1
Last updated: Thu Jun 13 17:44:19 2013
Last change: Thu Jun 13 17:43:16 2013 via cibadmin on rhcs-node01.local
Stack: classic openais (with plugin)
Current DC: rhcs-node02.local - partition with quorum
Version: 1.1.8-7.el6-394e906
2 Nodes configured, 2 expected votes
5 Resources configured.

Online: [ rhcs-node01.local rhcs-node02.local ]

 failover_ip	(ocf::heartbeat:IPaddr2):	Started rhcs-node02.local
 nginx_res	(ocf::heartbeat:nginx):	Started rhcs-node02.local
 Master/Slave Set: drbd_master_slave [drbd_res]
     Masters: [ rhcs-node02.local ]
     Slaves: [ rhcs-node01.local ]
 fs_res	(ocf::heartbeat:Filesystem):	Started rhcs-node02.local

# curl http://192.168.122.33
On shared storage...

# reboot -f

# crm_mon -1
Last updated: Thu Jun 13 17:45:07 2013
Last change: Thu Jun 13 17:45:00 2013 via cibadmin on rhcs-node01.local
Stack: classic openais (with plugin)
Current DC: rhcs-node01.local - partition WITHOUT quorum
Version: 1.1.8-7.el6-394e906
2 Nodes configured, 2 expected votes
5 Resources configured.

Online: [ rhcs-node01.local ]
OFFLINE: [ rhcs-node02.local ]

 failover_ip	(ocf::heartbeat:IPaddr2):	Started rhcs-node01.local
 nginx_res	(ocf::heartbeat:nginx):	Started rhcs-node01.local
 Master/Slave Set: drbd_master_slave [drbd_res]
     Masters: [ rhcs-node01.local ]
     Stopped: [ drbd_res:1 ]
 fs_res	(ocf::heartbeat:Filesystem):	Started rhcs-node01.local

# curl http://192.168.122.33
On shared storage...</textarea></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -25px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5593a443e0ef3-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-2">2</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-4">4</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-6">6</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-8">8</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-10">10</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-12">12</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-14">14</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-16">16</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-18">18</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-20">20</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-22">22</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-24">24</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-26">26</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-28">28</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-30">30</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-32">32</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-34">34</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-36">36</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-38">38</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-40">40</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-42">42</div><div class="crayon-num" data-line="crayon-5593a443e0ef3-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5593a443e0ef3-44">44</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-line" id="crayon-5593a443e0ef3-1"><span class="crayon-p"># crm_mon -1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-2"><span class="crayon-e">Last </span><span class="crayon-i">updated</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Thu </span><span class="crayon-i">Jun</span><span class="crayon-h"> </span><span class="crayon-cn">13</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-o">:</span><span class="crayon-cn">44</span><span class="crayon-o">:</span><span class="crayon-cn">19</span><span class="crayon-h"> </span><span class="crayon-cn">2013</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-3"><span class="crayon-e">Last </span><span class="crayon-i">change</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Thu </span><span class="crayon-i">Jun</span><span class="crayon-h"> </span><span class="crayon-cn">13</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-o">:</span><span class="crayon-cn">43</span><span class="crayon-o">:</span><span class="crayon-cn">16</span><span class="crayon-h"> </span><span class="crayon-cn">2013</span><span class="crayon-h"> </span><span class="crayon-e">via </span><span class="crayon-e">cibadmin </span><span class="crayon-e">on </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-4"><span class="crayon-i">Stack</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">classic </span><span class="crayon-e">openais</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">with </span><span class="crayon-i">plugin</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-5"><span class="crayon-e">Current </span><span class="crayon-i">DC</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">partition </span><span class="crayon-e">with </span><span class="crayon-e">quorum</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-6"><span class="crayon-i">Version</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1.1.8</span><span class="crayon-o">-</span><span class="crayon-cn">7.el6</span><span class="crayon-o">-</span><span class="crayon-cn">394e906</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-7"><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-e">Nodes </span><span class="crayon-i">configured</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-e">expected </span><span class="crayon-i">votes</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-8"><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-e">Resources </span><span class="crayon-v">configured</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-10"><span class="crayon-i">Online</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-12"><span class="crayon-h"> </span><span class="crayon-e">failover_ip</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span><span class="crayon-i">ocf</span><span class="crayon-o">::</span><span class="crayon-i">heartbeat</span><span class="crayon-o">:</span><span class="crayon-i">IPaddr2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">Started </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-13"><span class="crayon-h"> </span><span class="crayon-e">nginx_res</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span><span class="crayon-i">ocf</span><span class="crayon-o">::</span><span class="crayon-i">heartbeat</span><span class="crayon-o">:</span><span class="crayon-i">nginx</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">Started </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-14"><span class="crayon-h"> </span><span class="crayon-i">Master</span><span class="crayon-o">/</span><span class="crayon-e">Slave </span><span class="crayon-i">Set</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">drbd_master_slave</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">drbd_res</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">Masters</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">Slaves</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-17"><span class="crayon-h"> </span><span class="crayon-e">fs_res</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span><span class="crayon-i">ocf</span><span class="crayon-o">::</span><span class="crayon-i">heartbeat</span><span class="crayon-o">:</span><span class="crayon-i">Filesystem</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">Started </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-18">&nbsp;</div><div class="crayon-line" id="crayon-5593a443e0ef3-19"><span class="crayon-p"># curl http://192.168.122.33</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-20"><span class="crayon-e">On </span><span class="crayon-e">shared </span><span class="crayon-v">storage</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-22"><span class="crayon-p"># reboot -f</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-24"><span class="crayon-p"># crm_mon -1</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-25"><span class="crayon-e">Last </span><span class="crayon-i">updated</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Thu </span><span class="crayon-i">Jun</span><span class="crayon-h"> </span><span class="crayon-cn">13</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-o">:</span><span class="crayon-cn">45</span><span class="crayon-o">:</span><span class="crayon-cn">07</span><span class="crayon-h"> </span><span class="crayon-cn">2013</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-26"><span class="crayon-e">Last </span><span class="crayon-i">change</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">Thu </span><span class="crayon-i">Jun</span><span class="crayon-h"> </span><span class="crayon-cn">13</span><span class="crayon-h"> </span><span class="crayon-cn">17</span><span class="crayon-o">:</span><span class="crayon-cn">45</span><span class="crayon-o">:</span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">2013</span><span class="crayon-h"> </span><span class="crayon-e">via </span><span class="crayon-e">cibadmin </span><span class="crayon-e">on </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-27"><span class="crayon-i">Stack</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">classic </span><span class="crayon-e">openais</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">with </span><span class="crayon-i">plugin</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-28"><span class="crayon-e">Current </span><span class="crayon-i">DC</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-e">partition </span><span class="crayon-e">WITHOUT </span><span class="crayon-e">quorum</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-29"><span class="crayon-i">Version</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">1.1.8</span><span class="crayon-o">-</span><span class="crayon-cn">7.el6</span><span class="crayon-o">-</span><span class="crayon-cn">394e906</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-30"><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-e">Nodes </span><span class="crayon-i">configured</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-e">expected </span><span class="crayon-i">votes</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-31"><span class="crayon-cn">5</span><span class="crayon-h"> </span><span class="crayon-e">Resources </span><span class="crayon-v">configured</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-32">&nbsp;</div><div class="crayon-line" id="crayon-5593a443e0ef3-33"><span class="crayon-i">Online</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-34"><span class="crayon-i">OFFLINE</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node02</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-35">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-36"><span class="crayon-h"> </span><span class="crayon-e">failover_ip</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span><span class="crayon-i">ocf</span><span class="crayon-o">::</span><span class="crayon-i">heartbeat</span><span class="crayon-o">:</span><span class="crayon-i">IPaddr2</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">Started </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-37"><span class="crayon-h"> </span><span class="crayon-e">nginx_res</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span><span class="crayon-i">ocf</span><span class="crayon-o">::</span><span class="crayon-i">heartbeat</span><span class="crayon-o">:</span><span class="crayon-i">nginx</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">Started </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-38"><span class="crayon-h"> </span><span class="crayon-i">Master</span><span class="crayon-o">/</span><span class="crayon-e">Slave </span><span class="crayon-i">Set</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">drbd_master_slave</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-i">drbd_res</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">Masters</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span><span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-i">Stopped</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-i">drbd_res</span><span class="crayon-o">:</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5593a443e0ef3-41"><span class="crayon-h"> </span><span class="crayon-e">fs_res</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span><span class="crayon-i">ocf</span><span class="crayon-o">::</span><span class="crayon-i">heartbeat</span><span class="crayon-o">:</span><span class="crayon-i">Filesystem</span><span class="crayon-sy">)</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">Started </span><span class="crayon-i">rhcs</span><span class="crayon-o">-</span><span class="crayon-v">node01</span><span class="crayon-e">.local</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-42">&nbsp;</div><div class="crayon-line" id="crayon-5593a443e0ef3-43"><span class="crayon-p"># curl http://192.168.122.33</span></div><div class="crayon-line crayon-striped-line" id="crayon-5593a443e0ef3-44"><span class="crayon-e">On </span><span class="crayon-e">shared </span><span class="crayon-v">storage</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0136 seconds] -->
<p>Excellent – failover works correctly, and the content is correctly served from the replicated volume.</p>
<h1>Conclusion</h1>
<p>This has been a bit of a whirlwind tour of a complicated stack of software. A very viable alternative to “enterprise” cluster solutions such as RHCS or VCS, this approach can be adopted to cluster a wide range of applications.</p>
<p>There is a vast amount of documentation available, and a very active user base (i.e. mailing lists, etc.). If you need to implement a high-availability solution on Linux, then this is probably for you. I’ve never been much of a fan of RHCS, although in my opinion it still doesn’t come close to the ease of administration and general rock-solid stability of Solaris Cluster.</p>
<p>One place I’ve used this is a highly-available MySQL master server, with several standalone replicated slaves.</p>
<div class="yarpp-related">
<h3>Related posts:</h3><ol>
<li><a href="http://www.tokiwinter.com/mysql-cluster-adding-new-data-nodes-online/" rel="bookmark" title="MySQL Cluster: Adding New Data Nodes Online">MySQL Cluster: Adding New Data Nodes Online</a></li>
<li><a href="http://www.tokiwinter.com/building-a-highly-available-load-balancer-with-nginx-and-keepalived-on-centos/" rel="bookmark" title="Building a Highly-Available Load Balancer with Nginx and Keepalived on CentOS">Building a Highly-Available Load Balancer with Nginx and Keepalived on CentOS</a></li>
<li><a href="http://www.tokiwinter.com/solaris-cluster-4-1-part-one-initial-preparation/" rel="bookmark" title="Solaris Cluster 4.1 Part One: Initial Preparation">Solaris Cluster 4.1 Part One: Initial Preparation</a></li>
<li><a href="http://www.tokiwinter.com/solaris-cluster-4-1-part-three-cluster-resources/" rel="bookmark" title="Solaris Cluster 4.1 Part Three: Cluster Resources">Solaris Cluster 4.1 Part Three: Cluster Resources</a></li>
<li><a href="http://www.tokiwinter.com/aws-ruby-on-rails-deployment-part-1-nginx-installation-and-configuration/" rel="bookmark" title="AWS: Ruby on Rails Deployment Part 1: Nginx Installation and Configuration">AWS: Ruby on Rails Deployment Part 1: Nginx Installation and Configuration</a></li>
</ol>
</div>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="http://www.tokiwinter.com/category/unix-linux-howtos-tutorials/" title="View all posts in UNIX &amp; Linux How Tos and Tutorials" rel="category tag">UNIX &amp; Linux How Tos and Tutorials</a> and tagged <a href="http://www.tokiwinter.com/tag/centos/" rel="tag">CentOS</a>, <a href="http://www.tokiwinter.com/tag/clustering/" rel="tag">clustering</a>, <a href="http://www.tokiwinter.com/tag/corosync/" rel="tag">Corosync</a>, <a href="http://www.tokiwinter.com/tag/drbd/" rel="tag">DRBD</a>, <a href="http://www.tokiwinter.com/tag/high-availability/" rel="tag">High-Availability</a>, <a href="http://www.tokiwinter.com/tag/nginx/" rel="tag">nginx</a>, <a href="http://www.tokiwinter.com/tag/pacemaker/" rel="tag">Pacemaker</a> on <a href="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/Clustering with DRBD, Corosync and Pacemaker _ Toki Winter.html" title="7:06 pm" rel="bookmark"><time class="entry-date" datetime="2014-05-13T19:06:03+00:00">May 13, 2014</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="http://www.tokiwinter.com/author/toki/" title="View all posts by Toki Winter" rel="author">Toki Winter</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

				<nav class="nav-single">
					<h3 class="assistive-text">Post navigation</h3>
					<span class="nav-previous"><a href="http://www.tokiwinter.com/securing-centos-and-solaris-11-with-puppet/" rel="prev"><span class="meta-nav">←</span> Securing CentOS and Solaris 11 with Puppet</a></span>
					<span class="nav-next"><a href="http://www.tokiwinter.com/bind-10-configuring-dhcp-for-dhcpv4-clients/" rel="next">BIND 10: Configuring DHCP for DHCPv4 Clients <span class="meta-nav">→</span></a></span>
				</nav><!-- .nav-single -->

				
<div id="comments" class="comments-area">

	
	
									
</div><!-- #comments .comments-area -->
			
		</div><!-- #content -->
	</div><!-- #primary -->


			<div id="secondary" class="widget-area" role="complementary">
			<aside id="text-2" class="widget widget_text">			<div class="textwidget">tokiwinter.com is a site for the experienced UNIX user by a UNIX, Linux, and middleware specialist, and includes tonnes of tips, scripts, howtos and tutorials on everything from Solaris zones to alternative DNS servers and much more.</div>
		</aside><aside id="acx-social-icons-widget-2" class="widget acx-social-icons-desc"><h3 class="widget-title">follow me via …</h3><style>
.widget-acx-social-icons-widget-2-widget img 
{
width:32px; 
 } 
</style><div id="acurax_si_simple" class="acx_fsmi_float_fix widget-acx-social-icons-widget-2-widget" style="text-align:left;"><a href="http://www.facebook.com/tokiwinterdotcom" target="_blank" title="Visit Us On Facebook"><img src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/facebook.png" style="border:0px;" alt="Visit Us On Facebook"></a><a href="http://www.twitter.com/tokiwinter" target="_blank" title="Visit Us On Twitter"><img src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/twitter.png" style="border:0px;" alt="Visit Us On Twitter"></a><a href="https://plus.google.com/u/0/b/112164460822347822147/112164460822347822147" target="_blank" title="Visit Us On Google Plus"><img src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/googleplus.png" style="border:0px;" alt="Visit Us On Google Plus"></a><a href="http://www.linkedin.com/in/tokiwinter" target="_blank" title="Visit Us On Linkedin"><img src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/linkedin.png" style="border:0px;" alt="Visit Us On Linkedin"></a><a href="http://www.tokiwinter.com/feed/" target="_blank" title="Check Our Feed"><img src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/feed.png" style="border:0px;" alt="Check Our Feed"></a></div></aside><aside id="search-2" class="widget widget_search"><form role="search" method="get" id="searchform" action="http://www.tokiwinter.com/">
	<div><label class="screen-reader-text" for="s">Search for:</label>
	<input type="text" value="" name="s" id="s">
	<input type="submit" id="searchsubmit" value="Search">
	</div>
	</form></aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h3 class="widget-title">lately I’ve been writing about:</h3>		<ul>
					<li>
				<a href="http://www.tokiwinter.com/powerdns-with-bind-backend/" title="PowerDNS with BIND Backend">PowerDNS with BIND Backend</a>
						</li>
					<li>
				<a href="http://www.tokiwinter.com/configuring-gfs2-on-centos-7/" title="Configuring GFS2 on CentOS 7">Configuring GFS2 on CentOS 7</a>
						</li>
					<li>
				<a href="http://www.tokiwinter.com/building-a-highly-available-apache-cluster-on-centos-7/" title="Building a Highly-Available Apache Cluster on CentOS 7">Building a Highly-Available Apache Cluster on CentOS 7</a>
						</li>
					<li>
				<a href="http://www.tokiwinter.com/nagios-plugin-check_mem/" title="Nagios Plugin – check_mem">Nagios Plugin – check_mem</a>
						</li>
					<li>
				<a href="http://www.tokiwinter.com/configuring-and-deploying-mcollective-on-centos-6/" title="Configuring and Deploying MCollective with Puppet on CentOS 6">Configuring and Deploying MCollective with Puppet on CentOS 6</a>
						</li>
				</ul>
		</aside><aside id="categories-2" class="widget widget_categories"><h3 class="widget-title">categories</h3>		<ul>
	<li class="cat-item cat-item-50"><a href="http://www.tokiwinter.com/category/non-unix-operating-systems/" title="View all posts filed under Non-UNIX Operating Systems">Non-UNIX Operating Systems</a> (4)
</li>
	<li class="cat-item cat-item-140"><a href="http://www.tokiwinter.com/category/puppet-module/" title="View all posts filed under Puppet Module">Puppet Module</a> (5)
</li>
	<li class="cat-item cat-item-32"><a href="http://www.tokiwinter.com/category/unix-code-snippets/" title="View all posts filed under UNIX &amp; Linux Code Snippets">UNIX &amp; Linux Code Snippets</a> (15)
</li>
	<li class="cat-item cat-item-1"><a href="http://www.tokiwinter.com/category/unix-linux-howtos-tutorials/" title="View all posts filed under UNIX &amp; Linux How Tos and Tutorials">UNIX &amp; Linux How Tos and Tutorials</a> (89)
</li>
	<li class="cat-item cat-item-36"><a href="http://www.tokiwinter.com/category/unix-linux-scripts/" title="View all posts filed under UNIX &amp; Linux Scripts">UNIX &amp; Linux Scripts</a> (1)
</li>
	<li class="cat-item cat-item-31"><a href="http://www.tokiwinter.com/category/unix-industry/" title="View all posts filed under UNIX Industry">UNIX Industry</a> (3)
</li>
		</ul>
</aside><aside id="tag_cloud-2" class="widget widget_tag_cloud"><h3 class="widget-title">Tags</h3><div class="tagcloud"><a href="http://www.tokiwinter.com/tag/apache/" class="tag-link-61" title="6 topics" style="font-size: 13.886363636364pt;">Apache</a>
<a href="http://www.tokiwinter.com/tag/automation/" class="tag-link-47" title="3 topics" style="font-size: 9.9090909090909pt;">automation</a>
<a href="http://www.tokiwinter.com/tag/aws/" class="tag-link-112" title="3 topics" style="font-size: 9.9090909090909pt;">AWS</a>
<a href="http://www.tokiwinter.com/tag/bind/" class="tag-link-11" title="9 topics" style="font-size: 16.272727272727pt;">BIND</a>
<a href="http://www.tokiwinter.com/tag/centos/" class="tag-link-146" title="18 topics" style="font-size: 20.727272727273pt;">CentOS</a>
<a href="http://www.tokiwinter.com/tag/clustering/" class="tag-link-59" title="13 topics" style="font-size: 18.659090909091pt;">clustering</a>
<a href="http://www.tokiwinter.com/tag/decnet/" class="tag-link-52" title="2 topics" style="font-size: 8pt;">DECnet</a>
<a href="http://www.tokiwinter.com/tag/dns/" class="tag-link-35" title="7 topics" style="font-size: 14.681818181818pt;">DNS</a>
<a href="http://www.tokiwinter.com/tag/ec2/" class="tag-link-114" title="3 topics" style="font-size: 9.9090909090909pt;">EC2</a>
<a href="http://www.tokiwinter.com/tag/files-and-filesystems/" class="tag-link-67" title="4 topics" style="font-size: 11.5pt;">files and filesystems</a>
<a href="http://www.tokiwinter.com/tag/gnu/" class="tag-link-94" title="6 topics" style="font-size: 13.886363636364pt;">GNU</a>
<a href="http://www.tokiwinter.com/tag/hardening/" class="tag-link-156" title="3 topics" style="font-size: 9.9090909090909pt;">hardening</a>
<a href="http://www.tokiwinter.com/tag/high-availability/" class="tag-link-100" title="11 topics" style="font-size: 17.545454545455pt;">High-Availability</a>
<a href="http://www.tokiwinter.com/tag/httpd/" class="tag-link-62" title="9 topics" style="font-size: 16.272727272727pt;">HTTPD</a>
<a href="http://www.tokiwinter.com/tag/iscsi/" class="tag-link-131" title="3 topics" style="font-size: 9.9090909090909pt;">iSCSI</a>
<a href="http://www.tokiwinter.com/tag/ksh/" class="tag-link-69" title="3 topics" style="font-size: 9.9090909090909pt;">ksh</a>
<a href="http://www.tokiwinter.com/tag/kvm/" class="tag-link-124" title="3 topics" style="font-size: 9.9090909090909pt;">kvm</a>
<a href="http://www.tokiwinter.com/tag/legacy-articles/" class="tag-link-10" title="4 topics" style="font-size: 11.5pt;">legacy articles</a>
<a href="http://www.tokiwinter.com/tag/logging/" class="tag-link-13" title="2 topics" style="font-size: 8pt;">logging</a>
<a href="http://www.tokiwinter.com/tag/mod_rewrite/" class="tag-link-104" title="2 topics" style="font-size: 8pt;">mod_rewrite</a>
<a href="http://www.tokiwinter.com/tag/mysql/" class="tag-link-111" title="3 topics" style="font-size: 9.9090909090909pt;">MySQL</a>
<a href="http://www.tokiwinter.com/tag/nagios/" class="tag-link-103" title="3 topics" style="font-size: 9.9090909090909pt;">Nagios</a>
<a href="http://www.tokiwinter.com/tag/network-configuration/" class="tag-link-9" title="3 topics" style="font-size: 9.9090909090909pt;">network configuration</a>
<a href="http://www.tokiwinter.com/tag/networking/" class="tag-link-22" title="3 topics" style="font-size: 9.9090909090909pt;">networking</a>
<a href="http://www.tokiwinter.com/tag/nginx/" class="tag-link-116" title="5 topics" style="font-size: 12.772727272727pt;">nginx</a>
<a href="http://www.tokiwinter.com/tag/openvms/" class="tag-link-48" title="3 topics" style="font-size: 9.9090909090909pt;">OpenVMS</a>
<a href="http://www.tokiwinter.com/tag/oracle/" class="tag-link-8" title="4 topics" style="font-size: 11.5pt;">oracle</a>
<a href="http://www.tokiwinter.com/tag/perl/" class="tag-link-80" title="3 topics" style="font-size: 9.9090909090909pt;">perl</a>
<a href="http://www.tokiwinter.com/tag/puppet/" class="tag-link-141" title="9 topics" style="font-size: 16.272727272727pt;">puppet</a>
<a href="http://www.tokiwinter.com/tag/replication/" class="tag-link-54" title="3 topics" style="font-size: 9.9090909090909pt;">Replication</a>
<a href="http://www.tokiwinter.com/tag/rhcs/" class="tag-link-57" title="2 topics" style="font-size: 8pt;">RHCS</a>
<a href="http://www.tokiwinter.com/tag/ruby/" class="tag-link-117" title="3 topics" style="font-size: 9.9090909090909pt;">ruby</a>
<a href="http://www.tokiwinter.com/tag/security/" class="tag-link-3" title="10 topics" style="font-size: 16.909090909091pt;">security</a>
<a href="http://www.tokiwinter.com/tag/selinux/" class="tag-link-138" title="3 topics" style="font-size: 9.9090909090909pt;">SELinux</a>
<a href="http://www.tokiwinter.com/tag/shells/" class="tag-link-68" title="3 topics" style="font-size: 9.9090909090909pt;">shells</a>
<a href="http://www.tokiwinter.com/tag/solaris/" class="tag-link-7" title="22 topics" style="font-size: 22pt;">solaris</a>
<a href="http://www.tokiwinter.com/tag/solaris-11/" class="tag-link-129" title="9 topics" style="font-size: 16.272727272727pt;">solaris 11</a>
<a href="http://www.tokiwinter.com/tag/solaris-cluster/" class="tag-link-130" title="4 topics" style="font-size: 11.5pt;">solaris cluster</a>
<a href="http://www.tokiwinter.com/tag/ssl/" class="tag-link-24" title="2 topics" style="font-size: 8pt;">SSL</a>
<a href="http://www.tokiwinter.com/tag/text-manipulation/" class="tag-link-78" title="3 topics" style="font-size: 9.9090909090909pt;">text manipulation</a>
<a href="http://www.tokiwinter.com/tag/tips-and-tricks/" class="tag-link-18" title="6 topics" style="font-size: 13.886363636364pt;">tips and tricks</a>
<a href="http://www.tokiwinter.com/tag/ubuntu/" class="tag-link-119" title="3 topics" style="font-size: 9.9090909090909pt;">ubuntu</a>
<a href="http://www.tokiwinter.com/tag/virtualisation/" class="tag-link-42" title="4 topics" style="font-size: 11.5pt;">virtualisation</a>
<a href="http://www.tokiwinter.com/tag/zfs/" class="tag-link-26" title="6 topics" style="font-size: 13.886363636364pt;">ZFS</a>
<a href="http://www.tokiwinter.com/tag/zones/" class="tag-link-17" title="4 topics" style="font-size: 11.5pt;">zones</a></div>
</aside><aside id="text-3" class="widget widget_text">			<div class="textwidget"><script async="" src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/adsbygoogle.js"></script>
<!-- Toki Ads One -->
<ins class="adsbygoogle" style="display:inline-block;width:180px;height:150px" data-ad-client="ca-pub-2058880138595928" data-ad-slot="7689619630" data-adsbygoogle-status="done"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:150px;margin:0;padding:0;position:relative;visibility:visible;width:180px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:150px;margin:0;padding:0;position:relative;visibility:visible;width:180px;background-color:transparent"><iframe width="180" height="150" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;"></iframe></ins></ins></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script></div>
		</aside><aside id="text-4" class="widget widget_text">			<div class="textwidget"><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38226431-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></div>
		</aside>		</div><!-- #secondary -->
	<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-38173062-1']);
_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
	</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type="text/javascript" src="./Clustering with DRBD, Corosync and Pacemaker _ Toki Winter_files/navigation.js"></script>


</body></html>